!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@takram/planck-core"),require("three"),require("d3"),require("d3-geo-projection")):"function"==typeof define&&define.amd?define(["exports","@takram/planck-core","three","d3","d3-geo-projection"],t):t(e.Planck=e.Planck||{},e.Planck,e.THREE,e.d3,e.d3)}(this,function(e,p,v,h,o){"use strict";var d=function(e){return function(){var u=e.apply(this,arguments);return new Promise(function(o,a){return function t(e,r){try{var n=u[e](r),i=n.value}catch(e){return void a(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});o(i)}("next")})}},y=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},g=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),x=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},r=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},b=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},w=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},k=p.Namespace("Division"),a=function(){function n(e,t){y(this,n);var r=k(this);r.level=e,r.code=t}var t,r,i,o,a,u,s,c,l,f;return g(n,[{key:"properties",value:(f=d(regeneratorRuntime.mark(function e(t){var r,n,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.level.properties(t);case 2:if(r=e.sent,n=this.code,null!=(i=r[n])){e.next=8;break}throw o=this.level.identifier,new Error("Could not find properties for "+o+" "+n);case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"bounds",value:(l=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.properties(t);case 2:return e.abrupt("return",e.sent.bounds);case 3:case"end":return e.stop()}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"area",value:(c=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.properties(t);case 2:return e.abrupt("return",e.sent.area);case 3:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"centroid",value:(s=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.properties(t);case 2:return e.abrupt("return",e.sent.centroid);case 3:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"poleOfInaccessibility",value:(u=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.properties(t);case 2:return e.abrupt("return",e.sent.poleOfInaccessibility);case 3:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"geometry",value:(a=d(regeneratorRuntime.mark(function e(t,r){var n,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.level.geometries(t,r);case 2:if(n=e.sent,i=this.code,null!=(o=n[i])){e.next=8;break}throw a=this.level.identifier,new Error("Could not find "+t+" geometry for "+a+" "+i);case 8:return e.abrupt("return",o);case 9:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"shapeGeometry",value:(o=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.geometry("shapes",t));case 1:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"outlineGeometry",value:(i=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.geometry("outlines",t));case 1:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"borderGeometry",value:(r=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.geometry("borders",t));case 1:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"subdivisionGeometry",value:(t=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.geometry("subdivisions",t));case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"belongsTo",value:function(e){return e.level===this.level.superlevel&&e.code===this.level.coder.super(this.code)}},{key:"code",get:function(){return k(this).code}},{key:"level",get:function(){return k(this).level}},{key:"geography",get:function(){return this.level.geography}},{key:"data",get:function(){var t=this,e=k(this);return null==e.data&&(e.data=this.level.data.find(function(e){return e.code===t.code})),e.data}},{key:"name",get:function(){return this.data.name}},{key:"localizedName",get:function(){return this.data.localizedName||this.data.name}},{key:"neighbors",get:function(){var t=this,e=k(this);return null==e.neighbors&&(e.neighbors=this.data.neighbors.map(function(e){return t.constructor.for(e)})),[].concat(w(e.neighbors))}},{key:"superdivision",get:function(){var t=this,e=k(this);if(null==e.superdivision){var r=this.level.superlevel;e.superdivision=r?r.divisions.find(function(e){return t.belongsTo(e)}):null}return e.superdivision}},{key:"subdivisions",get:function(){var t=this,e=k(this);if(null==e.subdivisions){var r=this.level.sublevel;e.subdivisions=r?r.divisions.filter(function(e){return e.belongsTo(t)}):[]}return[].concat(w(e.subdivisions))}}]),n}();function q(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=e.toJSON(),n=r.data||{},i=[],o=t;if(n.index){var a=e.index.array,u=a.buffer;i.push([u,o]),n.index.array=[o,a.length],o+=u.byteLength}if(n.attributes)for(var s=Object.keys(n.attributes),c=0;c<s.length;++c){var l=s[c],f=e.attributes[l].array,h=f.buffer;i.push([h,o]),n.attributes[l].array=[o,f.length],o+=h.byteLength}return r.data=n,[r,i,o]}function s(e,t){var r=m({},e,{data:m({},e.data)});if(r.data.index){var n=r.data.index.type,i=new(Function.prototype.bind.apply(p.globalScope[n],[null].concat([t],w(r.data.index.array))));r.data.index=m({},r.data.index,{array:i})}if(r.data.attributes){for(var o={},a=Object.keys(r.data.attributes),u=0;u<a.length;++u){var s=a[u],c=r.data.attributes[s],l=c.type,f=new(Function.prototype.bind.apply(p.globalScope[l],[null].concat([t],w(c.array))));o[s]=m({},c,{array:f})}r.data.attributes=o}return(new v.BufferGeometryLoader).parse(r)}function i(e,t){for(var r=new ArrayBuffer(t),n=new Uint8Array(r),i=0;i<e.length;++i){var o=b(e[i],2),a=o[0],u=o[1];n.set(new Uint8Array(a),u)}return r}var j={packBufferGeometry:function(e){var t=q(e),r=b(t,3);return[r[0],i(r[1],r[2])]},packBufferGeometries:function(e){var t=function(e){if(Array.isArray(e)){for(var t=[],r=[],n=0,i=0;i<e.length;++i){var o=q(e[i],n),a=b(o,3),u=a[0],s=a[1],c=a[2];t.push(u),r.push.apply(r,w(s)),n=c}return[t,r,n]}for(var l={},f=[],h=0,p=Object.keys(e),v=0;v<p.length;++v){var d=p[v],y=q(e[d],h),g=b(y,3);u=g[0],s=g[1],c=g[2],l[d]=u,f.push.apply(f,w(s)),h=c}return[l,f,h]}(e),r=b(t,3);return[r[0],i(r[1],r[2])]},unpackBufferGeometry:function(e,t){return s(e,t)},unpackBufferGeometries:function(e,t){if(Array.isArray(e)){for(var r=[],n=0;n<e.length;++n)r.push(s(e,t));return r}for(var i={},o=Object.keys(e),a=0;a<o.length;++a){var u=o[a];i[u]=s(e[u],t)}return i}},u=p.Namespace("DivisionLevel"),c=function(){function n(e,t){y(this,n);var r=u(this);r.identifier=e,r.coder=t,r.divisions={},r.properties={},r.geometries={}}var r,i,t;return g(n,[{key:"init",value:function(e){u(this).geography=e}},{key:"division",value:function(e){var t=u(this),r=t.divisions[e];return null==r&&(r=new a(this,e),t.divisions[e]=r),r}},{key:"properties",value:(t=d(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=u(this),n=t?t.hash:null,null==r.properties[n]&&(i=p.FilePath.join(p.FilePath.dirname(this.geography.path),n||"",this.geography.identifier,this.identifier,"properties.json"),r.properties[n]=p.Request.json(i,{local:!0})),e.abrupt("return",r.properties[n]);case 4:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"geometries",value:(i=d(regeneratorRuntime.mark(function e(t,r){var n,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=u(this),i=r?r.hash:null,null==(o=n.geometries[i])&&(o={},n.geometries[i]=o),null==o[t]&&(o[t]=this.requestGeometries(t,r)),e.abrupt("return",o[t]);case 6:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"requestGeometries",value:(r=d(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=p.FilePath.join(p.FilePath.dirname(this.geography.path),r.hash,this.geography.identifier,this.identifier,t),o=i=void 0,e.prev=3,e.next=6,Promise.all([p.Request.json(n+".json"),p.Request.buffer(n+".buffer")]);case 6:a=e.sent,u=b(a,2),i=u[0],o=u[1],e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(3),e.t0;case 15:return e.abrupt("return",j.unpackBufferGeometries(i,o));case 16:case"end":return e.stop()}},e,this,[[3,12]])})),function(e,t){return r.apply(this,arguments)})},{key:"identifier",get:function(){return u(this).identifier}},{key:"coder",get:function(){return u(this).coder}},{key:"geography",get:function(){return u(this).geography}},{key:"data",get:function(){var e=u(this);return null==e.data&&(e.data=this.geography.data[this.identifier]),e.data}},{key:"divisions",get:function(){var n=this,i=u(this);return i.divisions=m({},i.divisions,this.data.reduce(function(e,t){var r=t.code;return null==i.divisions[r]?m({},e,x({},r,new a(n,r))):e},{})),Object.values(i.divisions)}},{key:"codes",get:function(){var e=u(this);return null==e.codes&&(e.codes=this.data.map(function(e){return e.code})),[].concat(w(e.codes))}},{key:"superlevel",get:function(){var e=u(this);if(null==e.superlevel){var t=this.geography.levels,r=t.indexOf(this);if(-1===r)throw new Error("Could not find levels for geography");e.superlevel=t[r-1]||null}return e.superlevel}},{key:"sublevel",get:function(){var e=u(this);if(null==e.sublevel){var t=this.geography.levels,r=t.indexOf(this);if(-1===r)throw new Error("Could not find levels for geography");e.sublevel=t[r+1]||null}return e.sublevel}}]),n}(),A=p.Namespace("Geography"),l=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];y(this,n);var r=A(this);r.identifier=e,r.levels=t,r.properties={},r.geometries={}}var t,r,i,o,a,u,s,c,l,f,h;return g(n,[{key:"init",value:(h=d(regeneratorRuntime.mark(function e(t,r){var n,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((n=A(this)).path=t,!r){e.next=8;break}return e.next=5,Promise.resolve(r);case 5:n.data=e.sent,e.next=11;break;case 8:return e.next=10,p.Request.json(t,{local:!0});case 10:n.data=e.sent;case 11:return e.next=13,Promise.all(this.levels.map(function(e){return e.init(i)}));case 13:case"end":return e.stop()}},e,this)})),function(e,t){return h.apply(this,arguments)})},{key:"division",value:function(t,e){var r=this.levels.find(function(e){return e.identifier===t});if(null==r)throw new Error("Could not find "+t+" level in geography");return r.division(e)}},{key:"divisions",value:function(t){var e=this.levels.find(function(e){return e.identifier===t});if(null==e)throw new Error("Could not find "+t+" level in geography");return e.divisions}},{key:"codes",value:function(t){var e=this.levels.find(function(e){return e.identifier===t});if(null==e)throw new Error("Could not find "+t+" level in geography");return e.codes}},{key:"properties",value:(f=d(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=A(this),n=t?t.hash:null,null==r.properties[n]&&(i=p.FilePath.join(p.FilePath.dirname(this.path),n||"",this.identifier,"properties.json"),r.properties[n]=p.Request.json(i,{local:!0})),e.abrupt("return",r.properties[n]);case 4:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"bounds",value:(l=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.properties(t);case 2:return e.abrupt("return",e.sent.bounds);case 3:case"end":return e.stop()}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"area",value:(c=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.properties(t);case 2:return e.abrupt("return",e.sent.area);case 3:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"centroid",value:(s=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.properties(t);case 2:return e.abrupt("return",e.sent.centroid);case 3:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"poleOfInaccessibility",value:(u=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.properties(t);case 2:return e.abrupt("return",e.sent.poleOfInaccessibility);case 3:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"geometry",value:(a=d(regeneratorRuntime.mark(function e(t,r){var n,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=A(this),i=r?r.hash:null,null==(o=n.geometries[i])&&(o={},n.geometries[i]=o),null==o[t]&&(o[t]=this.requestGeometry(t,r)),e.abrupt("return",o[t]);case 6:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"requestGeometry",value:(o=d(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=p.FilePath.join(p.FilePath.dirname(this.path),r.hash,this.identifier,t),o=i=void 0,e.prev=3,e.next=6,Promise.all([p.Request.json(n+".json"),p.Request.buffer(n+".buffer")]);case 6:a=e.sent,u=b(a,2),i=u[0],o=u[1],e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(3),e.t0;case 15:return e.abrupt("return",j.unpackBufferGeometry(i,o));case 16:case"end":return e.stop()}},e,this,[[3,12]])})),function(e,t){return o.apply(this,arguments)})},{key:"shapeGeometry",value:(i=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.geometry("shape",t));case 1:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"outlineGeometry",value:(r=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.geometry("outline",t));case 1:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"subdivisionGeometry",value:(t=d(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.geometry("subdivision",t));case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"identifier",get:function(){return A(this).identifier}},{key:"levels",get:function(){return[].concat(w(A(this).levels))}},{key:"path",get:function(){return A(this).path}},{key:"data",get:function(){var e=A(this);if(!e.data)throw new Error("Data is missing for "+this.identifier);return e.data}}]),n}();function f(e){return e}function t(e,t){var o=function(e){if(null==e)return f;var o,a,u=e.scale[0],s=e.scale[1],c=e.translate[0],l=e.translate[1];return function(e,t){t||(o=a=0);var r=2,n=e.length,i=new Array(n);for(i[0]=(o+=e[0])*u+c,i[1]=(a+=e[1])*s+l;r<n;)i[r]=e[r],++r;return i}}(e.transform),a=e.arcs;function i(e,t){t.length&&t.pop();for(var r=a[e<0?~e:e],n=0,i=r.length;n<i;++n)t.push(o(r[n],n));e<0&&function(e,t){for(var r,n=e.length,i=n-t;i<--n;)r=e[i],e[i++]=e[n],e[n]=r}(t,i)}function u(e){return o(e)}function s(e){for(var t=[],r=0,n=e.length;r<n;++r)i(e[r],t);return t.length<2&&t.push(t[0]),t}function r(e){for(var t=s(e);t.length<4;)t.push(t[0]);return t}function c(e){return e.map(r)}return function e(t){var r,n=t.type;switch(n){case"GeometryCollection":return{type:n,geometries:t.geometries.map(e)};case"Point":r=u(t.coordinates);break;case"MultiPoint":r=t.coordinates.map(u);break;case"LineString":r=s(t.arcs);break;case"MultiLineString":r=t.arcs.map(s);break;case"Polygon":r=c(t.arcs);break;case"MultiPolygon":r=t.arcs.map(c);break;default:return null}return{type:n,coordinates:r}}(t)}function R(s,i){var o={},c={},l={},a=[],u=-1;function e(e,t){for(var r in e){var n=e[r];delete t[n.start],delete n.start,delete n.end,n.forEach(function(e){o[e<0?~e:e]=1}),a.push(n)}}return i.forEach(function(e,t){var r,n=s.arcs[e<0?~e:e];n.length<3&&!n[1][0]&&!n[1][1]&&(r=i[++u],i[u]=e,i[t]=r)}),i.forEach(function(e){var t,r,n=function(e){var t,r=s.arcs[e<0?~e:e],n=r[0];s.transform?(t=[0,0],r.forEach(function(e){t[0]+=e[0],t[1]+=e[1]})):t=r[r.length-1];return e<0?[t,n]:[n,t]}(e),i=n[0],o=n[1];if(t=l[i])if(delete l[t.end],t.push(e),t.end=o,r=c[o]){delete c[r.start];var a=r===t?t:t.concat(r);c[a.start=t.start]=l[a.end=r.end]=a}else c[t.start]=l[t.end]=t;else if(t=c[o])if(delete c[t.start],t.unshift(e),t.start=i,r=l[i]){delete l[r.end];var u=r===t?t:r.concat(t);c[u.start=r.start]=l[u.end=t.end]=u}else c[t.start]=l[t.end]=t;else c[(t=[e]).start=i]=l[t.end=o]=t}),e(l,c),e(c,l),i.forEach(function(e){o[e<0?~e:e]||a.push([e])}),a}function G(e){return t(e,function(e,t,r){var n,i,o;if(1<arguments.length)n=function(e,t,r){var n,i=[],o=[];function a(e){var t=e<0?~e:e;(o[t]||(o[t]=[])).push({i:e,g:n})}function u(e){e.forEach(a)}function s(e){e.forEach(u)}return function e(t){switch((n=t).type){case"GeometryCollection":t.geometries.forEach(e);break;case"LineString":u(t.arcs);break;case"MultiLineString":case"Polygon":s(t.arcs);break;case"MultiPolygon":t.arcs.forEach(s)}}(t),o.forEach(null==r?function(e){i.push(e[0].i)}:function(e){r(e[0].g,e[e.length-1].g)&&i.push(e[0].i)}),i}(0,t,r);else for(i=0,n=new Array(o=e.arcs.length);i<o;++i)n[i]=i;return{type:"MultiLineString",arcs:R(e,n)}}.apply(this,arguments))}function P(e){return t(e,function(u,e){var s={},r=[],n=[];function i(t){t.forEach(function(e){e.forEach(function(e){(s[e=e<0?~e:e]||(s[e]=[])).push(t)})}),r.push(t)}function c(e){return function(e){for(var t,r=-1,n=e.length,i=e[n-1],o=0;++r<n;)t=i,i=e[r],o+=t[0]*i[1]-t[1]*i[0];return Math.abs(o)}(t(u,{type:"Polygon",arcs:[e]}).coordinates[0])}return e.forEach(function e(t){switch(t.type){case"GeometryCollection":t.geometries.forEach(e);break;case"Polygon":i(t.arcs);break;case"MultiPolygon":t.arcs.forEach(i)}}),r.forEach(function(e){if(!e._){var t=[],r=[e];for(e._=1,n.push(t);e=r.pop();)t.push(e),e.forEach(function(e){e.forEach(function(e){s[e<0?~e:e].forEach(function(e){e._||(e._=1,r.push(e))})})})}}),r.forEach(function(e){delete e._}),{type:"MultiPolygon",arcs:n.map(function(e){var t,r=[];if(e.forEach(function(e){e.forEach(function(e){e.forEach(function(e){s[e<0?~e:e].length<2&&r.push(e)})})}),1<(t=(r=R(u,r)).length))for(var n,i,o=1,a=c(r[0]);o<t;++o)(n=c(r[o]))>a&&(i=r[0],r[0]=r[o],r[o]=i,a=n);return r})}}.apply(this,arguments))}function E(e,t){for(var r=0,n=e.length;r<n;){var i=r+n>>>1;e[i]<t?r=i+1:n=i}return r}Math.PI;var M=C,S=C;function C(e,t,r){r=r||2;var n,i,o,a,u,s,c,l=t&&t.length,f=l?t[0]*r:e.length,h=O(e,0,f,r,!0),p=[];if(!h)return p;if(l&&(h=function(e,t,r,n){var i,o,a,u,s,c=[];for(i=0,o=t.length;i<o;i++)a=t[i]*n,u=i<o-1?t[i+1]*n:e.length,(s=O(e,a,u,n,!1))===s.next&&(s.steiner=!0),c.push(I(s));for(c.sort(B),i=0;i<c.length;i++)F(c[i],r),r=T(r,r.next);return r}(e,t,h,r)),e.length>80*r){n=o=e[0],i=a=e[1];for(var v=r;v<f;v+=r)(u=e[v])<n&&(n=u),(s=e[v+1])<i&&(i=s),o<u&&(o=u),a<s&&(a=s);c=0!==(c=Math.max(o-n,a-i))?1/c:0}return Z(h,p,r,n,i,c),p}function O(e,t,r,n,i){var o,a;if(i===0<$(e,t,r,n))for(o=t;o<r;o+=n)a=K(o,e[o],e[o+1],a);else for(o=r-n;t<=o;o-=n)a=K(o,e[o],e[o+1],a);return a&&J(a,a.next)&&(X(a),a=a.next),a}function T(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!J(n,n.next)&&0!==H(n.prev,n,n.next))n=n.next;else{if(X(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function Z(e,t,r,n,i,o,a){if(e){!a&&o&&function(e,t,r,n){var i=e;for(;null===i.z&&(i.z=L(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next,i!==e;);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,o,a,u,s,c=1;do{for(r=e,o=e=null,a=0;r;){for(a++,n=r,t=u=0;t<c&&(u++,n=n.nextZ);t++);for(s=c;0<u||0<s&&n;)0!==u&&(0===s||!n||r.z<=n.z)?(r=(i=r).nextZ,u--):(n=(i=n).nextZ,s--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}o.nextZ=null,c*=2}while(1<a)}(i)}(e,n,i,o);for(var u,s,c=e;e.prev!==e.next;)if(u=e.prev,s=e.next,o?z(e,n,i,o):_(e))t.push(u.i/r),t.push(e.i/r),t.push(s.i/r),X(e),e=s.next,c=s.next;else if((e=s)===c){a?1===a?Z(e=N(e,t,r),t,r,n,i,o,2):2===a&&U(e,t,r,n,i,o):Z(T(e),t,r,n,i,o,1);break}}}function _(e){var t=e.prev,r=e,n=e.next;if(0<=H(t,r,n))return!1;for(var i=e.next.next;i!==e.prev;){if(D(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&0<=H(i.prev,i,i.next))return!1;i=i.next}return!0}function z(e,t,r,n){var i=e.prev,o=e,a=e.next;if(0<=H(i,o,a))return!1;for(var u=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,s=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,l=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,f=L(u,s,t,r,n),h=L(c,l,t,r,n),p=e.prevZ,v=e.nextZ;p&&p.z>=f&&v&&v.z<=h;){if(p!==e.prev&&p!==e.next&&D(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&0<=H(p.prev,p,p.next))return!1;if(p=p.prevZ,v!==e.prev&&v!==e.next&&D(i.x,i.y,o.x,o.y,a.x,a.y,v.x,v.y)&&0<=H(v.prev,v,v.next))return!1;v=v.nextZ}for(;p&&p.z>=f;){if(p!==e.prev&&p!==e.next&&D(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&0<=H(p.prev,p,p.next))return!1;p=p.prevZ}for(;v&&v.z<=h;){if(v!==e.prev&&v!==e.next&&D(i.x,i.y,o.x,o.y,a.x,a.y,v.x,v.y)&&0<=H(v.prev,v,v.next))return!1;v=v.nextZ}return!0}function N(e,t,r){var n=e;do{var i=n.prev,o=n.next.next;!J(i,o)&&Q(i,n,n.next,o)&&V(i,o)&&V(o,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(o.i/r),X(n),X(n.next),n=e=o),n=n.next}while(n!==e);return n}function U(e,t,r,n,i,o){var a,u,s=e;do{for(var c=s.next.next;c!==s.prev;){if(s.i!==c.i&&(u=c,(a=s).next.i!==u.i&&a.prev.i!==u.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Q(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(a,u)&&V(a,u)&&V(u,a)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;for(;r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next,r!==e;);return n}(a,u))){var l=W(s,c);return s=T(s,s.next),l=T(l,l.next),Z(s,t,r,n,i,o),void Z(l,t,r,n,i,o)}c=c.next}s=s.next}while(s!==e)}function B(e,t){return e.x-t.x}function F(e,t){if(t=function(e,t){var r,n=t,i=e.x,o=e.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var u=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=i&&a<u){if((a=u)===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===a)return r.prev;var s,c=r,l=r.x,f=r.y,h=1/0;n=r.next;for(;n!==c;)i>=n.x&&n.x>=l&&i!==n.x&&D(o<f?i:a,o,l,f,o<f?a:i,o,n.x,n.y)&&((s=Math.abs(o-n.y)/(i-n.x))<h||s===h&&n.x>r.x)&&V(n,e)&&(r=n,h=s),n=n.next;return r}(e,t)){var r=W(t,e);T(r,r.next)}}function L(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function I(e){for(var t=e,r=e;t.x<r.x&&(r=t),(t=t.next)!==e;);return r}function D(e,t,r,n,i,o,a,u){return 0<=(i-a)*(t-u)-(e-a)*(o-u)&&0<=(e-a)*(n-u)-(r-a)*(t-u)&&0<=(r-a)*(o-u)-(i-a)*(n-u)}function H(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function J(e,t){return e.x===t.x&&e.y===t.y}function Q(e,t,r,n){return!!(J(e,t)&&J(r,n)||J(e,n)&&J(r,t))||0<H(e,t,r)!=0<H(e,t,n)&&0<H(r,n,e)!=0<H(r,n,t)}function V(e,t){return H(e.prev,e,e.next)<0?0<=H(e,t,e.next)&&0<=H(e,e.prev,t):H(e,t,e.prev)<0||H(e,e.next,t)<0}function W(e,t){var r=new Y(e.i,e.x,e.y),n=new Y(t.i,t.x,t.y),i=e.next,o=t.prev;return(e.next=t).prev=e,(r.next=i).prev=r,(n.next=r).prev=n,(o.next=n).prev=o,n}function K(e,t,r,n){var i=new Y(e,t,r);return n?(i.next=n.next,(i.prev=n).next.prev=i,n.next=i):(i.prev=i).next=i,i}function X(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Y(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function $(e,t,r,n){for(var i=0,o=t,a=r-n;o<r;o+=n)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}C.deviation=function(e,t,r,n){var i=t&&t.length,o=i?t[0]*r:e.length,a=Math.abs($(e,0,o,r));if(i)for(var u=0,s=t.length;u<s;u++){var c=t[u]*r,l=u<s-1?t[u+1]*r:e.length;a-=Math.abs($(e,c,l,r))}var f=0;for(u=0;u<n.length;u+=3){var h=n[u]*r,p=n[u+1]*r,v=n[u+2]*r;f+=Math.abs((e[h]-e[v])*(e[p+1]-e[h+1])-(e[h]-e[p])*(e[v+1]-e[h+1]))}return 0===a&&0===f?0:Math.abs((f-a)/a)},C.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)r.vertices.push(e[i][o][a]);0<i&&(n+=e[i-1].length,r.holes.push(n))}return r},M.default=S;var ee=te;function te(e,t){if(!(this instanceof te))return new te(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||re,0<this.length)for(var r=this.length>>1;0<=r;r--)this._down(r)}function re(e,t){return e<t?-1:t<e?1:0}te.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,0<this.length&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,r=this.compare,n=t[e];0<e;){var i=e-1>>1,o=t[i];if(0<=r(n,o))break;t[e]=o,e=i}t[e]=n},_down:function(e){for(var t=this.data,r=this.compare,n=this.length,i=n>>1,o=t[e];e<i;){var a=1+(e<<1),u=a+1,s=t[a];if(u<n&&r(t[u],s)<0&&(s=t[a=u]),0<=r(s,o))break;t[e]=s,e=a}t[e]=o}};var ne=oe,ie=oe;function oe(e,t,r){var n,i,o,a;t=t||1;for(var u=0;u<e[0].length;u++){var s=e[0][u];(!u||s[0]<n)&&(n=s[0]),(!u||s[1]<i)&&(i=s[1]),(!u||s[0]>o)&&(o=s[0]),(!u||s[1]>a)&&(a=s[1])}var c=o-n,l=a-i,f=Math.min(c,l),h=f/2,p=new ee(null,ae);if(0===f)return[n,i];for(var v=n;v<o;v+=f)for(var d=i;d<a;d+=f)p.push(new ue(v+h,d+h,h,e));var y=function(e){for(var t=0,r=0,n=0,i=e[0],o=0,a=i.length,u=a-1;o<a;u=o++){var s=i[o],c=i[u],l=s[0]*c[1]-c[0]*s[1];r+=(s[0]+c[0])*l,n+=(s[1]+c[1])*l,t+=3*l}return 0===t?new ue(i[0][0],i[0][1],0,e):new ue(r/t,n/t,0,e)}(e),g=new ue(n+c/2,i+l/2,0,e);g.d>y.d&&(y=g);for(var x=p.length;p.length;){var m=p.pop();m.d>y.d&&(y=m,r&&console.log("found best %d after %d probes",Math.round(1e4*m.d)/1e4,x)),m.max-y.d<=t||(h=m.h/2,p.push(new ue(m.x-h,m.y-h,h,e)),p.push(new ue(m.x+h,m.y-h,h,e)),p.push(new ue(m.x-h,m.y+h,h,e)),p.push(new ue(m.x+h,m.y+h,h,e)),x+=4)}return r&&(console.log("num probes: "+x),console.log("best distance: "+y.d)),[y.x,y.y]}function ae(e,t){return t.max-e.max}function ue(e,t,r,n){this.x=e,this.y=t,this.h=r,this.d=function(e,t,r){for(var n=!1,i=1/0,o=0;o<r.length;o++)for(var a=r[o],u=0,s=a.length,c=s-1;u<s;c=u++){var l=a[u],f=a[c];l[1]>t!=f[1]>t&&e<(f[0]-l[0])*(t-l[1])/(f[1]-l[1])+l[0]&&(n=!n),i=Math.min(i,se(e,t,l,f))}return(n?1:-1)*Math.sqrt(i)}(e,t,n),this.max=this.d+this.h*Math.SQRT2}function se(e,t,r,n){var i=r[0],o=r[1],a=n[0]-i,u=n[1]-o;if(0!==a||0!==u){var s=((e-i)*a+(t-o)*u)/(a*a+u*u);1<s?(i=n[0],o=n[1]):0<s&&(i+=a*s,o+=u*s)}return(a=e-i)*a+(u=t-o)*u}function Ue(e,t,r,n){this.message=e,this.expected=t,this.found=r,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,Ue)}ne.default=ie,function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(Ue,Error),Ue.buildMessage=function(e,t){var r,o={literal:function(e){return'"'+i(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?a(e.parts[t][0])+"-"+a(e.parts[t][1]):a(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+n(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+n(e)})}function a(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+n(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+n(e)})}return"Expected "+function(e){var t,r,n,i=new Array(e.length);for(t=0;t<e.length;t++)i[t]=(n=e[t],o[n.type](n));if(i.sort(),0<i.length){for(r=t=1;t<i.length;t++)i[t-1]!==i[t]&&(i[r]=i[t],r++);i.length=r}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+((r=t)?'"'+i(r)+'"':"end of input")+" found."};var ce=function(u,e){e=void 0!==e?e:{};var t,f={},r={svg_path:pe},n=pe,o=function(e){if(!e)return[];for(var t=[],r=0;r<e.length;r++)t=t.concat.apply(t,e[r]);var n=t[0];return n&&"m"==n.code&&(delete n.relative,n.code="M"),t},a=function(e,t){return function(e,t){if(!t)return[e];for(var r=[e],n=0,i=t.length;n<i;n++)r[n+1]=t[n][1];return r}(e,t)},s=/^[Mm]/,c=ce(["M","m"],!1,!1),l=function(e,t,r){var n=Ne(e,[t]);return r&&(n=n.concat(Ne("M"==e?"L":"l",r[1]))),n},i=/^[Zz]/,h=ce(["Z","z"],!1,!1),p=function(){return Ne("Z")},v=/^[Ll]/,d=ce(["L","l"],!1,!1),y=function(e,t){return Ne(e,t)},g=/^[Hh]/,x=ce(["H","h"],!1,!1),m=function(e,t){return Ne(e,t.map(function(e){return{x:e}}))},b=/^[Vv]/,w=ce(["V","v"],!1,!1),k=function(e,t){return Ne(e,t.map(function(e){return{y:e}}))},q=/^[Cc]/,j=ce(["C","c"],!1,!1),A=function(e,t,r){return{x1:e.x,y1:e.y,x2:t.x,y2:t.y,x:r.x,y:r.y}},R=/^[Ss]/,G=ce(["S","s"],!1,!1),P=function(e,t){return{x2:e.x,y2:e.y,x:t.x,y:t.y}},E=/^[Qq]/,M=ce(["Q","q"],!1,!1),S=function(e,t){return{x1:e.x,y1:e.y,x:t.x,y:t.y}},C=/^[Tt]/,O=ce(["T","t"],!1,!1),T=/^[Aa]/,Z=ce(["A","a"],!1,!1),_=function(e,t,r,n,i,o){return{rx:e,ry:t,xAxisRotation:r,largeArc:n,sweep:i,x:o.x,y:o.y}},z=function(e,t){return{x:e,y:t}},N=function(e){return 1*e},U=function(e){return 1*e.join("")},B=/^[01]/,F=ce(["0","1"],!1,!1),L=function(e){return"1"==e},I=function(){return""},D=",",H=se(",",!1),J=function(e){return e.join("")},Q=".",V=se(".",!1),W=/^[eE]/,K=ce(["e","E"],!1,!1),X=/^[+\-]/,Y=ce(["+","-"],!1,!1),$=/^[0-9]/,ee=ce([["0","9"]],!1,!1),te=function(e){return e.join("")},re=/^[ \t\n\r]/,ne=ce([" ","\t","\n","\r"],!1,!1),ie=0,oe=[{line:1,column:1}],ae=0,ue=[];if("startRule"in e){if(!(e.startRule in r))throw new Error("Can't start parsing from rule \""+e.startRule+'".');n=r[e.startRule]}function se(e,t){return{type:"literal",text:e,ignoreCase:t}}function ce(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function le(e){var t,r=oe[e];if(r)return r;for(t=e-1;!oe[t];)t--;for(r={line:(r=oe[t]).line,column:r.column};t<e;)10===u.charCodeAt(t)?(r.line++,r.column=1):r.column++,t++;return oe[e]=r}function fe(e,t){var r=le(e),n=le(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function he(e){ie<ae||(ae<ie&&(ae=ie,ue=[]),ue.push(e))}function pe(){var e,t,r,n,i;for(e=ie,t=[],r=Ce();r!==f;)t.push(r),r=Ce();if(t!==f)if((r=function(){var e,t,r,n,i,o;if(e=ie,(t=ve())!==f){for(r=[],n=ie,i=[],o=Ce();o!==f;)i.push(o),o=Ce();for(i!==f&&(o=ve())!==f?n=i=[i,o]:(ie=n,n=f);n!==f;){for(r.push(n),n=ie,i=[],o=Ce();o!==f;)i.push(o),o=Ce();i!==f&&(o=ve())!==f?n=i=[i,o]:(ie=n,n=f)}r!==f?(t=a(t,r),e=t):(ie=e,e=f)}else ie=e,e=f;return e}())===f&&(r=null),r!==f){for(n=[],i=Ce();i!==f;)n.push(i),i=Ce();n!==f?e=t=o(r):(ie=e,e=f)}else ie=e,e=f;else ie=e,e=f;return e}function ve(){var e,t,r,n,i,o;if(e=ie,(t=function(){var e,t,r,n,i,o,a;if(e=ie,s.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=f,he(c)),t!==f){for(r=[],n=Ce();n!==f;)r.push(n),n=Ce();r!==f&&(n=ke())!==f?(i=ie,(o=Re())===f&&(o=null),o!==f&&(a=ye())!==f?i=o=[o,a]:(ie=i,i=f),i===f&&(i=null),i!==f?(t=l(t,n,i),e=t):(ie=e,e=f)):(ie=e,e=f)}else ie=e,e=f;return e}())!==f){for(r=[],n=ie,i=[],o=Ce();o!==f;)i.push(o),o=Ce();for(i!==f&&(o=de())!==f?n=i=[i,o]:(ie=n,n=f);n!==f;){for(r.push(n),n=ie,i=[],o=Ce();o!==f;)i.push(o),o=Ce();i!==f&&(o=de())!==f?n=i=[i,o]:(ie=n,n=f)}r!==f?e=t=a(t,r):(ie=e,e=f)}else ie=e,e=f;return e}function de(){var e,t;return i.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=f,he(h)),t!==f&&(t=p()),(e=t)===f&&(e=function(){var e,t,r,n;if(e=ie,v.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=f,he(d)),t!==f){for(r=[],n=Ce();n!==f;)r.push(n),n=Ce();r!==f&&(n=ye())!==f?(t=y(t,n),e=t):(ie=e,e=f)}else ie=e,e=f;return e}())===f&&(e=function(){var e,t,r,n;if(e=ie,g.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=f,he(x)),t!==f){for(r=[],n=Ce();n!==f;)r.push(n),n=Ce();r!==f&&(n=ge())!==f?(t=m(t,n),e=t):(ie=e,e=f)}else ie=e,e=f;return e}())===f&&(e=function(){var e,t,r,n;if(e=ie,b.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=f,he(w)),t!==f){for(r=[],n=Ce();n!==f;)r.push(n),n=Ce();r!==f&&(n=ge())!==f?(t=k(t,n),e=t):(ie=e,e=f)}else ie=e,e=f;return e}())===f&&(e=function(){var e,t,r,n;if(e=ie,q.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=f,he(j)),t!==f){for(r=[],n=Ce();n!==f;)r.push(n),n=Ce();r!==f&&(n=function(){var e,t,r,n,i,o;if(e=ie,(t=xe())!==f){for(r=[],n=ie,(i=Re())===f&&(i=null),i!==f&&(o=xe())!==f?n=i=[i,o]:(ie=n,n=f);n!==f;)r.push(n),n=ie,(i=Re())===f&&(i=null),i!==f&&(o=xe())!==f?n=i=[i,o]:(ie=n,n=f);r!==f?(t=a(t,r),e=t):(ie=e,e=f)}else ie=e,e=f;return e}())!==f?(t=y(t,n),e=t):(ie=e,e=f)}else ie=e,e=f;return e}())===f&&(e=function(){var e,t,r,n;if(e=ie,R.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=f,he(G)),t!==f){for(r=[],n=Ce();n!==f;)r.push(n),n=Ce();r!==f&&(n=function(){var e,t,r,n,i,o;if(e=ie,(t=me())!==f){for(r=[],n=ie,(i=Re())===f&&(i=null),i!==f&&(o=me())!==f?n=i=[i,o]:(ie=n,n=f);n!==f;)r.push(n),n=ie,(i=Re())===f&&(i=null),i!==f&&(o=me())!==f?n=i=[i,o]:(ie=n,n=f);r!==f?(t=a(t,r),e=t):(ie=e,e=f)}else ie=e,e=f;return e}())!==f?(t=y(t,n),e=t):(ie=e,e=f)}else ie=e,e=f;return e}())===f&&(e=function(){var e,t,r,n;if(e=ie,E.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=f,he(M)),t!==f){for(r=[],n=Ce();n!==f;)r.push(n),n=Ce();r!==f&&(n=function(){var e,t,r,n,i,o;if(e=ie,(t=be())!==f){for(r=[],n=ie,(i=Re())===f&&(i=null),i!==f&&(o=be())!==f?n=i=[i,o]:(ie=n,n=f);n!==f;)r.push(n),n=ie,(i=Re())===f&&(i=null),i!==f&&(o=be())!==f?n=i=[i,o]:(ie=n,n=f);r!==f?(t=a(t,r),e=t):(ie=e,e=f)}else ie=e,e=f;return e}())!==f?(t=y(t,n),e=t):(ie=e,e=f)}else ie=e,e=f;return e}())===f&&(e=function(){var e,t,r,n;if(e=ie,C.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=f,he(O)),t!==f){for(r=[],n=Ce();n!==f;)r.push(n),n=Ce();r!==f&&(n=function(){var e,t,r,n,i,o;if(e=ie,(t=ke())!==f){for(r=[],n=ie,(i=Re())===f&&(i=null),i!==f&&(o=ke())!==f?n=i=[i,o]:(ie=n,n=f);n!==f;)r.push(n),n=ie,(i=Re())===f&&(i=null),i!==f&&(o=ke())!==f?n=i=[i,o]:(ie=n,n=f);r!==f?(t=a(t,r),e=t):(ie=e,e=f)}else ie=e,e=f;return e}())!==f?(t=y(t,n),e=t):(ie=e,e=f)}else ie=e,e=f;return e}())===f&&(e=function(){var e,t,r,n;if(e=ie,T.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=f,he(Z)),t!==f){for(r=[],n=Ce();n!==f;)r.push(n),n=Ce();r!==f&&(n=function(){var e,t,r,n,i,o;if(e=ie,(t=we())!==f){for(r=[],n=ie,(i=Re())===f&&(i=null),i!==f&&(o=we())!==f?n=i=[i,o]:(ie=n,n=f);n!==f;)r.push(n),n=ie,(i=Re())===f&&(i=null),i!==f&&(o=we())!==f?n=i=[i,o]:(ie=n,n=f);r!==f?(t=a(t,r),e=t):(ie=e,e=f)}else ie=e,e=f;return e}())!==f?(t=y(t,n),e=t):(ie=e,e=f)}else ie=e,e=f;return e}()),e}function ye(){var e,t,r,n,i,o;if(e=ie,(t=ke())!==f){for(r=[],n=ie,(i=Re())===f&&(i=null),i!==f&&(o=ke())!==f?n=i=[i,o]:(ie=n,n=f);n!==f;)r.push(n),n=ie,(i=Re())===f&&(i=null),i!==f&&(o=ke())!==f?n=i=[i,o]:(ie=n,n=f);r!==f?e=t=a(t,r):(ie=e,e=f)}else ie=e,e=f;return e}function ge(){var e,t,r,n,i,o;if(e=ie,(t=je())!==f){for(r=[],n=ie,(i=Re())===f&&(i=null),i!==f&&(o=je())!==f?n=i=[i,o]:(ie=n,n=f);n!==f;)r.push(n),n=ie,(i=Re())===f&&(i=null),i!==f&&(o=je())!==f?n=i=[i,o]:(ie=n,n=f);r!==f?e=t=a(t,r):(ie=e,e=f)}else ie=e,e=f;return e}function xe(){var e,t,r,n,i,o;return e=ie,(t=ke())!==f?((r=Re())===f&&(r=null),r!==f&&(n=ke())!==f?((i=Re())===f&&(i=null),i!==f&&(o=ke())!==f?e=t=A(t,n,o):(ie=e,e=f)):(ie=e,e=f)):(ie=e,e=f),e}function me(){var e,t,r,n;return e=ie,(t=ke())!==f?((r=Re())===f&&(r=null),r!==f&&(n=ke())!==f?e=t=P(t,n):(ie=e,e=f)):(ie=e,e=f),e}function be(){var e,t,r,n;return e=ie,(t=ke())!==f?((r=Re())===f&&(r=null),r!==f&&(n=ke())!==f?e=t=S(t,n):(ie=e,e=f)):(ie=e,e=f),e}function we(){var e,t,r,n,i,o,a,u,s,c,l;return e=ie,(t=qe())!==f?((r=Re())===f&&(r=null),r!==f&&(n=qe())!==f?((i=Re())===f&&(i=null),i!==f&&(o=je())!==f&&Re()!==f&&(a=Ae())!==f?((u=Re())===f&&(u=null),u!==f&&(s=Ae())!==f?((c=Re())===f&&(c=null),c!==f&&(l=ke())!==f?e=t=_(t,n,o,a,s,l):(ie=e,e=f)):(ie=e,e=f)):(ie=e,e=f)):(ie=e,e=f)):(ie=e,e=f),e}function ke(){var e,t,r,n;return e=ie,(t=je())!==f?((r=Re())===f&&(r=null),r!==f&&(n=je())!==f?e=t=z(t,n):(ie=e,e=f)):(ie=e,e=f),e}function qe(){var e;return(e=Pe())===f&&(e=Se()),e!==f&&(e=N(e)),e}function je(){var e,t,r;return e=ie,(t=Me())===f&&(t=null),t!==f&&(r=Pe())!==f?e=t=[t,r]:(ie=e,e=f),e===f&&(e=ie,(t=Me())===f&&(t=null),t!==f&&(r=Se())!==f?e=t=[t,r]:(ie=e,e=f)),e!==f&&(e=U(e)),e}function Ae(){var e;return B.test(u.charAt(ie))?(e=u.charAt(ie),ie++):(e=f,he(F)),e!==f&&(e=L(e)),e}function Re(){var e,t,r,n,i;if(e=ie,t=[],(r=Ce())!==f)for(;r!==f;)t.push(r),r=Ce();else t=f;if(t!==f)if((r=Ge())===f&&(r=null),r!==f){for(n=[],i=Ce();i!==f;)n.push(i),i=Ce();n!==f?e=t=[t,r,n]:(ie=e,e=f)}else ie=e,e=f;else ie=e,e=f;if(e===f){if(t=e=ie,(r=Ge())!==f){for(n=[],i=Ce();i!==f;)n.push(i),i=Ce();n!==f?t=r=[r,n]:(ie=t,t=f)}else ie=t,t=f;t!==f&&(t=I()),e=t}return e}function Ge(){var e;return 44===u.charCodeAt(ie)?(e=D,ie++):(e=f,he(H)),e}function Pe(){var e,t,r,n,i,o,a;return n=e=ie,(i=Se())===f&&(i=null),i!==f?(46===u.charCodeAt(ie)?(o=Q,ie++):(o=f,he(V)),o!==f&&(a=Se())!==f?n=i=[i,o,a]:(ie=n,n=f)):(ie=n,n=f),n===f&&(n=ie,(i=Se())!==f?(46===u.charCodeAt(ie)?(o=Q,ie++):(o=f,he(V)),o!==f?n=i=[i,o]:(ie=n,n=f)):(ie=n,n=f)),n!==f&&(n=J(n)),(t=n)!==f?((r=Ee())===f&&(r=null),r!==f?e=t=[t,r]:(ie=e,e=f)):(ie=e,e=f),e===f&&(e=ie,(t=Se())!==f&&(r=Ee())!==f?e=t=[t,r]:(ie=e,e=f)),e!==f&&(e=J(e)),e}function Ee(){var e,t,r,n;return e=ie,W.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=f,he(K)),t!==f?((r=Me())===f&&(r=null),r!==f&&(n=Se())!==f?e=t=[t,r,n]:(ie=e,e=f)):(ie=e,e=f),e!==f&&(e=J(e)),e}function Me(){var e;return X.test(u.charAt(ie))?(e=u.charAt(ie),ie++):(e=f,he(Y)),e}function Se(){var e,t;if(e=[],$.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=f,he(ee)),t!==f)for(;t!==f;)e.push(t),$.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=f,he(ee));else e=f;return e!==f&&(e=te(e)),e}function Ce(){var e;return re.test(u.charAt(ie))?(e=u.charAt(ie),ie++):(e=f,he(ne)),e!==f&&(e=I()),e}var Oe,Te,Ze,_e={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var ze in _e)_e[ze.toUpperCase()]=_e[ze];function Ne(e,t){t||(t=[{}]);for(var r=t.length;r--;){var n={code:e,command:_e[e]};for(var i in e==e.toLowerCase()&&(n.relative=!0),t[r])n[i]=t[r][i];t[r]=n}return t}if((t=n())!==f&&ie===u.length)return t;throw t!==f&&ie<u.length&&he({type:"end"}),Oe=ue,Te=ae<u.length?u.charAt(ae):null,Ze=ae<u.length?fe(ae,ae+1):fe(ae,ae),new Ue(Ue.buildMessage(Oe,Te),Oe,Te,Ze)};(ce.parseSVG=ce).makeAbsolute=function(e){var r,n={x:0,y:0},i={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return e.forEach(function(e){for(var t in"moveto"===e.command&&(r=e),e.x0=n.x,e.y0=n.y,i)t in e&&(e[t]+=e.relative?e[i[t]]:0);"x"in e||(e.x=n.x),"y"in e||(e.y=n.y),e.relative=!1,e.code=e.code.toUpperCase(),"closepath"==e.command&&(e.x=r.x,e.y=r.y),n=e}),e};var le=ce;function fe(e,t){return e.x*t.y-e.y*t.x}function he(e,t,r){if(e.x<r.x&&r.x<=t.x||t.x<r.x&&r.x<=e.x){var n=e.y;if(e.x!==t.x&&(n=e.y+(t.y-e.y)*(r.x-e.x)/(t.x-e.x)),r.y>n)return 1}return 0}var pe={winding:function(e){if(!(e.length<3)){var t=e[0],r=fe(e[e.length-1].v2,t.v1);return(r=e.reduce(function(e,t){return e+fe(t.v1,t.v2)},r))<0?"ccw":0<r?"cw":void 0}},contains:function(e,r){if(e.length<3)return!1;var t=e[0],n=he(e[e.length-1].v2,t.v1,r);return(n=e.reduce(function(e,t){return e+he(t.v1,t.v2,r)},n))%2==1},parse:function(e){var r=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=0,i=0,o=0,a=0,u=0,s=0,c=void 0,t=le(e).reduce(function(e,t){switch(t.code){case"M":case"m":!0===t.relative?(u+=t.x,s+=t.y):(u=t.x,s=t.y),c&&0===c.curves.length&&e.pop(),c=new v.Path,e.push(c),r?c.moveTo(u,-s):c.moveTo(u,s);break;case"L":case"l":!0===t.relative?(u+=t.x,s+=t.y):(u=t.x,s=t.y),r?c.lineTo(u,-s):c.lineTo(u,s);break;case"V":case"v":!0===t.relative?s+=t.y:s=t.y,r?c.lineTo(u,-s):c.lineTo(u,s);break;case"H":case"h":!0===t.relative?u+=t.x:u=t.x,r?c.lineTo(u,-s):c.lineTo(u,s);break;case"C":case"c":!0===t.relative?(n=u+t.x1,i=s+t.y1,o=u+t.x2,a=s+t.y2,u+=t.x,s+=t.y):(n=t.x1,i=t.y1,o=t.x2,a=t.y2,u=t.x,s=t.y),r?c.bezierCurveTo(n,-i,o,-a,u,-s):c.bezierCurveTo(n,i,o,a,u,s);break;case"S":case"s":n=u+(u-o),i=s+(s-a),!0===t.relative?(o=u+t.x2,a=s+t.y2,u+=t.x,s+=t.y):(o=t.x2,a=t.y2,u=t.x,s=t.y),r?c.bezierCurveTo(n,-i,o,-a,u,-s):c.bezierCurveTo(n,i,o,a,u,s);break;case"Q":case"q":!0===t.relative?(n=u+t.x1,i=s+t.y1,u+=t.x,s+=t.y):(n=t.x1,i=t.y1,u=t.x,s=t.y),r?c.quadraticCurveTo(n,-i,u,-s):c.quadraticCurveTo(n,i,u,s);break;case"T":case"t":n=u+(u-n),i=s+(s-i),!0===t.relative?(u+=t.x,s+=t.y):(u=t.x,s=t.y),r?c.quadraticCurveTo(n,-i,u,-s):c.quadraticCurveTo(n,i,u,s);break;case"A":case"a":throw new p.ImplementationError;case"Z":c.closePath();break;default:throw new Error('Unknown code "'+t.code+'"')}return e},[]);return 0===t.length?null:1===t.length?t[0]:t.reduce(function(e,t){return e.add(t),e},new v.Shape)}};function ve(e){return e+"Code"}function de(e,t){var i=t.includes,o=t.excludes,a=e;if(i)for(var u=Object.keys(i),r=function(e){var t=u[e],r=ve(t),n=[].concat(i[t]);a=a.filter(function(e){return n.includes(e.properties[r])})},n=0;n<u.length;++n)r(n);if(o){var s=Object.keys(o),c=function(e){var t=s[e],r=ve(t),n=[].concat(o[t]);a=a.filter(function(e){return!n.includes(e.properties[r])})};for(n=0;n<s.length;++n)c(n)}return a}function ye(e,t){var r=e.reduce(function(e,t){return e.concat(t.x,t.y)},[]),n=e.length,i=[];t.forEach(function(e,t){i.push(n),n+=e.length,r=r.concat(e.reduce(function(e,t){return e.concat(t.x,t.y)},[]))});for(var o=M(r,i,2),a=[],u=0;u<o.length;u+=3)a.push(o.slice(u,u+3));return a}function ge(e,u){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];return e.coordinates.reduce(function(e,t,r){var n=u.path({type:"Polygon",coordinates:t});if(!n)return s.push(r),e;var i=pe.parse(n,!0),o=void 0;o=i instanceof v.Shape?i.curves:[i];var a=new v.Shape;return o.forEach(function(e){var t=pe.winding(e.curves);"ccw"===t?a.add(e):"cw"===t&&a.holes.push(e)}),0===a.holes.length?e.concat(a.curves.map(function(e){var t=new v.Shape;return t.add(e),t})):e.concat(a)},[])}function xe(e){var n=new Float32Array(6*e.length);e.forEach(function(e,t){var r=6*t;n[r+0]=e.v1.x,n[r+1]=e.v1.y,n[r+3]=e.v2.x,n[r+4]=e.v2.y});var t=new v.BufferGeometry,r=new v.BufferAttribute(n,3);return t.addAttribute("position",r),t}var me=p.Namespace("GeographyBuilder"),be=function(){function t(e){y(this,t),me(this).levels=[].concat(w(e))}var r;return g(t,[{key:"init",value:(r=d(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=me(this),"string"!=typeof t){e.next=7;break}return e.next=4,p.Request.json(t,{local:!0});case 4:r.data=e.sent,e.next=10;break;case 7:return e.next=9,Promise.resolve(t);case 9:r.data=e.sent;case 10:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"property",value:function(e,t){var r=t.level,n=t.code,i=t.projection,o=this.data.objects.geography.geometries;r&&(o=de(o,{includes:x({},r,n)}));var a=P(this.data,o);return i?i.path[e](a):h["geo"+e.charAt().toUpperCase()+e.slice(1)](a)}},{key:"bounds",value:function(e){return this.property("bounds",e)}},{key:"area",value:function(e){return this.property("area",e)}},{key:"centroid",value:function(e){return this.property("centroid",e)}},{key:"poleOfInaccessibility",value:function(e){var t=e.level,r=e.code,n=e.projection,i=e.precision,o=void 0===i?.01:i,a=this.data.objects.geography.geometries;if(t&&(a=de(a,{includes:x({},t,r)})),a=P(this.data,a),n){var u=p.Array.max(a.coordinates,function(e){return n.path.area({type:"Polygon",coordinates:e})});if(!u)return console.warn("Unable to derive pole of inaccessibility:",t,r),null;var s=n.path({type:"Polygon",coordinates:u});if(!s)return console.warn("Unable to derive pole of inaccessibility:",t,r),null;var c=pe.parse(s,!0);if(!c)return console.warn("Unable to derive pole of inaccessibility:",t,r),null;var l=(c instanceof v.Shape?c.curves:[c]).map(function(e){return e.curves.map(function(e){return[e.v1.x,e.v1.y]})});return ne(l,Math.sqrt(n.path.area({type:"Polygon",coordinates:u}))*o)}var f=p.Array.max(a.coordinates,function(e){return h.geoArea({type:"Polygon",coordinates:e})});return f?ne(f,Math.sqrt(h.geoArea({type:"Polygon",coordinates:f}))*o):(console.warn("Unable to derive pole of inaccessibility:",t,r),null)}},{key:"shapes",value:function(e){var t=e.geometries,r=e.projection,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return ge(P(this.data,t),r,n)}},{key:"shapeGeometry",value:function(e){var t=e.geometries,r=e.projection,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return function(e){var t=v.ShapeUtils.triangulateShape;v.ShapeUtils.triangulateShape=ye;var r=(new v.BufferGeometry).fromGeometry(e.reduce(function(e,t){return e.merge(new v.ShapeGeometry(t)),e},new v.Geometry));return v.ShapeUtils.triangulateShape=t,r.computeBoundingSphere(),r}(ge(P(this.data,t),r,n))}},{key:"outlineGeometry",value:function(e){var t=e.geometries,r=e.projection,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],i=ge(P(this.data,t),r,n);return xe(i.reduce(function(e,t){return e.concat(t.curves.reduce(function(e,t){return e.concat(t.curves)},[]),t.holes.reduce(function(e,t){return e.concat(t.curves)},[]))},[]))}},{key:"borderGeometry",value:function(e){var t=e.object,r=e.filter,n=e.projection,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],o=G(this.data,t,r),a=n.path(o);if(!a)return i.push(0),xe([]);var u=pe.parse(a,!0);return xe(u instanceof v.Shape?u.curves.reduce(function(e,t){return e.concat(t.curves)},[]):u.curves)}},{key:"geographyShapes",value:function(e){var t=e.projection,r=e.excludes,n=this.data.objects.geography.geometries,i=[],o=this.shapes({projection:t,geometries:de(n,{excludes:r})},i);return 0!==i.length&&console.warn("Unable to project "+i.length+" polygons"),o}},{key:"geographyShapeGeometry",value:function(e){var t=e.projection,r=e.excludes,n=this.data.objects.geography.geometries,i=[],o=this.shapeGeometry({projection:t,geometries:de(n,{excludes:r})},i);return 0!==i.length&&console.warn("Unable to project "+i.length+" polygons"),o}},{key:"geographyOutlineGeometry",value:function(e){var t=e.projection,r=e.excludes,n=this.data.objects.geography.geometries,i=[],o=this.outlineGeometry({projection:t,geometries:de(n,{excludes:r})},i);return 0!==i.length&&console.warn("Unable to project "+i.length+" polygons"),o}},{key:"geographySubdivisionGeometry",value:function(e){var t=e.projection,r=e.excludes,n={type:"GeometryCollection",geometries:de(this.data.objects.geography.geometries,{excludes:r})},i=ve(this.levels[0]),o=[],a=this.borderGeometry({projection:t,object:n,filter:function(e,t){return e.properties[i]!==t.properties[i]}},o);return 0!==o.length?new v.BufferGeometry:a}},{key:"divisionShapes",value:function(e){var t=e.level,r=e.code,n=e.projection,i=e.excludes,o=this.data.objects.geography.geometries,a=[],u=this.shapes({projection:n,geometries:de(o,{includes:x({},t,r),excludes:i})},a);return 0!==a.length&&console.warn(a.length+" polygons failed to project"),u}},{key:"divisionShapeGeometry",value:function(e){var t=e.level,r=e.code,n=e.projection,i=e.excludes,o=this.data.objects.geography.geometries,a=[],u=this.shapeGeometry({projection:n,geometries:de(o,{includes:x({},t,r),excludes:i})},a);return 0!==a.length&&console.warn("Unable to project "+a.length+" polygons:",t,r),u}},{key:"divisionOutlineGeometry",value:function(e){var t=e.level,r=e.code,n=e.projection,i=e.excludes,o=this.data.objects.geography.geometries,a=[],u=this.outlineGeometry({projection:n,geometries:de(o,{includes:x({},t,r),excludes:i})},a);return 0!==a.length&&console.warn("Unable to project "+a.length+" polygons:",t,r),u}},{key:"divisionBorderGeometry",value:function(e){var t=this,r=e.level,n=e.code,i=e.projection,o=e.excludes,a=function(){var e=t.levels.indexOf(r);if(-1===e)throw new Error('Could not find level "'+r+'" in geography');if(0<e)return t.levels[e-1]}(),u=this.data.objects.geography.geometries;u=de(u,{excludes:o}),a&&(u=de(u,{includes:x({},a,n)}));var s=de(u,{includes:x({},r,n)}).map(function(e){return u.indexOf(e)}),c=function(e){var n={},t=e.map(function(){return[]});function r(e,r){e.forEach(function(e){e<0&&(e=~e);var t=n[e];t?t.push(r):n[e]=[r]})}function i(e,t){e.forEach(function(e){r(e,t)})}var o={LineString:r,MultiLineString:i,Polygon:i,MultiPolygon:function(e,t){e.forEach(function(e){i(e,t)})}};for(var a in e.forEach(function t(e,r){"GeometryCollection"===e.type?e.geometries.forEach(function(e){t(e,r)}):e.type in o&&o[e.type](e.arcs,r)}),n)for(var u=n[a],s=u.length,c=0;c<s;++c)for(var l=c+1;l<s;++l){var f,h=u[c],p=u[l];(f=t[h])[a=E(f,p)]!==p&&f.splice(a,0,p),(f=t[p])[a=E(f,h)]!==h&&f.splice(a,0,h)}return t}(u),l={type:"GeometryCollection",geometries:u.filter(function(e,t){return s.includes(t)||s.some(function(e){return c[e].includes(t)})})},f=ve(r),h=[],p=this.borderGeometry({projection:i,object:l,filter:function(e,t){return e.properties[f]===n?e.properties[f]<t.properties[f]:e.properties[f]>t.properties[f]}},h);return 0!==h.length?new v.BufferGeometry:p}},{key:"divisionSubdivisionGeometry",value:function(e){var t=e.level,r=e.code,n=e.projection,i=e.excludes,o={type:"GeometryCollection",geometries:de(this.data.objects.geography.geometries,{includes:x({},t,r),excludes:i})},a=[],u=this.borderGeometry({projection:n,object:o,filter:function(e,t){return e!==t}},a);return 0!==a.length?new v.BufferGeometry:u}},{key:"levels",get:function(){return[].concat(w(me(this).levels))}},{key:"data",get:function(){return me(this).data}}]),t}(),we=function(e){function t(){return y(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"japan",[new c("prefecture"),new c("municipality",{coerce:function(e){return parseInt(e,10)},super:function(e){return parseInt((""+e).slice(0,-3),10)}})]))}return r(t,l),t}();function ke(e,t){return{quotient:Math.floor(e/t),remainder:e%t}}function qe(e){var t=Math.floor(e);return{integral:t,fractional:e-t}}var je={primary:function(e){var t=ke(60*e[1],40);return 100*t.quotient+1*(t=qe(e[0]-100)).integral},secondary:function(e){var t=ke(60*e[1],40),r=t.quotient,n=(t=ke(t.remainder,5)).quotient;return 1e4*r+100*(t=qe(e[0]-100)).integral+10*n+1*(t=ke(60*t.fractional,7.5)).quotient},basic:function(e){var t=ke(60*e[1],40),r=t.quotient,n=(t=ke(t.remainder,5)).quotient,i=(t=ke(60*t.remainder,30)).quotient;return 1e6*r+1e4*(t=qe(e[0]-100)).integral+1e3*n+100*(t=ke(60*t.fractional,7.5)).quotient+10*i+1*(t=ke(60*t.remainder,45)).quotient},half:function(e){var t=ke(60*e[1],40),r=t.quotient,n=(t=ke(t.remainder,5)).quotient,i=(t=ke(60*t.remainder,30)).quotient,o=(t=ke(t.remainder,15)).quotient;return 1e7*r+1e5*(t=qe(e[0]-100)).integral+1e4*n+1e3*(t=ke(60*t.fractional,7.5)).quotient+100*i+10*(t=ke(60*t.remainder,45)).quotient+1*(2*o+(t=ke(t.remainder,22.5)).quotient+1)},quarter:function(e){var t=ke(60*e[1],40),r=t.quotient,n=(t=ke(t.remainder,5)).quotient,i=(t=ke(60*t.remainder,30)).quotient,o=(t=ke(t.remainder,15)).quotient,a=(t=ke(t.remainder,7.5)).quotient;return 1e8*r+1e6*(t=qe(e[0]-100)).integral+1e5*n+1e4*(t=ke(60*t.fractional,7.5)).quotient+1e3*i+100*(t=ke(60*t.remainder,45)).quotient+10*(2*o+(t=ke(t.remainder,22.5)).quotient+1)+1*(2*a+(t=ke(t.remainder,11.25)).quotient+1)},eighth:function(e){var t=ke(60*e[1],40),r=t.quotient,n=(t=ke(t.remainder,5)).quotient,i=(t=ke(60*t.remainder,30)).quotient,o=(t=ke(t.remainder,15)).quotient,a=(t=ke(t.remainder,7.5)).quotient,u=(t=ke(t.remainder,3.75)).quotient;return 1e9*r+1e7*(t=qe(e[0]-100)).integral+1e6*n+1e5*(t=ke(60*t.fractional,7.5)).quotient+1e4*i+1e3*(t=ke(60*t.remainder,45)).quotient+100*(2*o+(t=ke(t.remainder,22.5)).quotient+1)+10*(2*a+(t=ke(t.remainder,11.25)).quotient+1)+1*(2*u+(t=ke(t.remainder,5.625)).quotient+1)}},Ae={primary:function(e){var t=ke(e,100),r=t.quotient;return[3600*((t=ke(t.remainder,1)).quotient+100)/3600,2400*r/3600]},secondary:function(e){var t=ke(e,1e4),r=t.quotient,n=(t=ke(t.remainder,100)).quotient,i=(t=ke(t.remainder,10)).quotient;return[(3600*(n+100)+450*(t=ke(t.remainder,1)).quotient)/3600,(2400*r+300*i)/3600]},basic:function(e){var t=ke(e,1e6),r=t.quotient,n=(t=ke(t.remainder,1e4)).quotient,i=(t=ke(t.remainder,1e3)).quotient,o=(t=ke(t.remainder,100)).quotient,a=(t=ke(t.remainder,10)).quotient;return[(3600*(n+100)+450*o+45*(t=ke(t.remainder,1)).quotient)/3600,(2400*r+300*i+30*a)/3600]},half:function(e){var t=ke(e,1e7),r=t.quotient,n=(t=ke(t.remainder,1e5)).quotient,i=(t=ke(t.remainder,1e4)).quotient,o=(t=ke(t.remainder,1e3)).quotient,a=(t=ke(t.remainder,100)).quotient,u=(t=ke(t.remainder,10)).quotient,s=(t=ke(t.remainder,1)).quotient;return[(3600*(n+100)+450*o+45*u+22.5*(s-1&1))/3600,(2400*r+300*i+30*a+15*(s-1>>1))/3600]},quarter:function(e){var t=ke(e,1e8),r=t.quotient,n=(t=ke(t.remainder,1e6)).quotient,i=(t=ke(t.remainder,1e5)).quotient,o=(t=ke(t.remainder,1e4)).quotient,a=(t=ke(t.remainder,1e3)).quotient,u=(t=ke(t.remainder,100)).quotient,s=(t=ke(t.remainder,10)).quotient,c=(t=ke(t.remainder,1)).quotient;return[(3600*(n+100)+450*o+45*u+22.5*(s-1&1)+11.25*(c-1&1))/3600,(2400*r+300*i+30*a+15*(s-1>>1)+7.5*(c-1>>1))/3600]},eighth:function(e){var t=ke(e,1e9),r=t.quotient,n=(t=ke(t.remainder,1e7)).quotient,i=(t=ke(t.remainder,1e6)).quotient,o=(t=ke(t.remainder,1e5)).quotient,a=(t=ke(t.remainder,1e4)).quotient,u=(t=ke(t.remainder,1e3)).quotient,s=(t=ke(t.remainder,100)).quotient,c=(t=ke(t.remainder,10)).quotient,l=(t=ke(t.remainder,1)).quotient;return[(3600*(n+100)+450*o+45*u+22.5*(s-1&1)+11.25*(c-1&1)+5.625*(l-1&1))/3600,(2400*r+300*i+30*a+15*(s-1>>1)+7.5*(c-1>>1)+3.75*(l-1>>1))/3600]}},Re=p.Namespace("JapanRegionalMesh"),Ge=function(){function n(e,t){y(this,n);var r=Re(this);r.name=e,r.size=[].concat(w(t))}return g(n,[{key:"code",value:function(e){return je[this.name](e)}},{key:"origin",value:function(e){return Ae[this.name](e)}},{key:"center",value:function(e){var t=this.origin(e),r=this.size;return[t[0]+r[0]/2,t[1]+r[1]/2]}},{key:"name",get:function(){return Re(this).name}},{key:"size",get:function(){return[].concat(w(Re(this).size))}}]),n}(),Pe={primary:new Ge("primary",[1,2400/3600]),secondary:new Ge("secondary",[.125,300/3600]),basic:new Ge("basic",[.0125,30/3600]),half:new Ge("half",[.00625,15/3600]),quarter:new Ge("quarter",[.003125,7.5/3600]),eighth:new Ge("eighth",[.0015625,3.75/3600])};var Ee,Me=(function(e,t){!function(){var b=Math.PI,f=Math.sin,h=Math.cos,p=Math.tan,n=Math.asin,v=Math.atan2,c=Math.acos,k=b/180,r=864e5,t=2440588,i=2451545;function w(e){return new Date((e+.5-t)*r)}function q(e){return e.valueOf()/r-.5+t-i}var o=23.4397*k;function a(e,t){return v(f(e)*h(o)-p(t)*f(o),h(e))}function j(e,t){return n(f(t)*h(o)+h(t)*f(o)*f(e))}function d(e,t,r){return v(f(e),h(e)*f(t)-p(r)*h(t))}function y(e,t,r){return n(f(t)*f(r)+h(t)*h(r)*h(e))}function g(e,t){return k*(280.16+360.9856235*e)-t}function A(e){return k*(357.5291+.98560028*e)}function R(e){return e+k*(1.9148*f(e)+.02*f(2*e)+3e-4*f(3*e))+102.9372*k+b}function s(e){var t=R(A(e));return{dec:j(t,0),ra:a(t,0)}}var G={getPosition:function(e,t,r){var n=k*-r,i=k*t,o=q(e),a=s(o),u=g(o,n)-a.ra;return{azimuth:d(u,i,a.dec),altitude:y(u,i,a.dec)}}},P=G.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];G.addTime=function(e,t,r){P.push([e,t,r])};var E=9e-4;function M(e,t,r){return E+(e+t)/(2*b)+r}function S(e,t,r){return i+e+.0053*f(t)-.0069*f(2*r)}function C(e,t,r,n,i,o,a){var u,s;return S(M((u=r,s=n,c((f(e)-f(u)*f(s))/(h(u)*h(s)))),t,i),o,a)}function x(e){var t=k*(134.963+13.064993*e),r=k*(93.272+13.22935*e),n=k*(218.316+13.176396*e)+6.289*k*f(t),i=5.128*k*f(r),o=385001-20905*h(t);return{ra:a(n,i),dec:j(n,i),dist:o}}function O(e,t){return new Date(e.valueOf()+t*r/24)}G.getTimes=function(e,t,r){var n,i,o,a,u,s,c,l=k*-r,f=k*t,h=q(e),p=(s=h,c=l,Math.round(s-E-c/(2*b))),v=M(0,l,p),d=A(v),y=R(d),g=j(y,0),x=S(v,d,y),m={solarNoon:w(x),nadir:w(x-.5)};for(n=0,i=P.length;n<i;n+=1)u=x-((a=C((o=P[n])[0]*k,l,f,g,p,d,y))-x),m[o[1]]=w(u),m[o[2]]=w(a);return m},G.getMoonPosition=function(e,t,r){var n,i=k*-r,o=k*t,a=q(e),u=x(a),s=g(a,i)-u.ra,c=y(s,o,u.dec),l=v(f(s),p(o)*h(u.dec)-f(u.dec)*h(s));return c+=((n=c)<0&&(n=0),2967e-7/Math.tan(n+.00312536/(n+.08901179))),{azimuth:d(s,o,u.dec),altitude:c,distance:u.dist,parallacticAngle:l}},G.getMoonIllumination=function(e){var t=q(e||new Date),r=s(t),n=x(t),i=c(f(r.dec)*f(n.dec)+h(r.dec)*h(n.dec)*h(r.ra-n.ra)),o=v(149598e3*f(i),n.dist-149598e3*h(i)),a=v(h(r.dec)*f(r.ra-n.ra),f(r.dec)*h(n.dec)-h(r.dec)*f(n.dec)*h(r.ra-n.ra));return{fraction:(1+h(o))/2,phase:.5+.5*o*(a<0?-1:1)/Math.PI,angle:a}},G.getMoonTimes=function(e,t,r,n){var i=new Date(e);n?i.setUTCHours(0,0,0,0):i.setHours(0,0,0,0);for(var o,a,u,s,c,l,f,h,p,v,d,y,g,x=.133*k,m=G.getMoonPosition(i,t,r).altitude-x,b=1;b<=24&&(o=G.getMoonPosition(O(i,b),t,r).altitude-x,h=((c=(m+(a=G.getMoonPosition(O(i,b+1),t,r).altitude-x))/2-o)*(f=-(l=(a-m)/2)/(2*c))+l)*f+o,(v=0)<=(p=l*l-4*c*o)&&(d=f-(g=Math.sqrt(p)/(2*Math.abs(c))),y=f+g,Math.abs(d)<=1&&v++,Math.abs(y)<=1&&v++,d<-1&&(d=y)),1===v?m<0?u=b+d:s=b+d:2===v&&(u=b+(h<0?y:d),s=b+(h<0?d:y)),!u||!s);b+=2)m=a;var w={};return u&&(w.rise=O(i,u)),s&&(w.set=O(i,s)),u||s||(w[0<h?"alwaysUp":"alwaysDown"]=!0),w},e.exports=G}()}(Ee={exports:{}},Ee.exports),Ee.exports),Se=p.Namespace("Projection"),Ce=function(){function l(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.name,r=void 0===t?"Equirectangular":t,n=e.scale,i=void 0===n?1e4:n,o=e.origin,a=void 0===o?[0,0]:o,u=e.rotates,s=void 0===u?[!0,!0]:u;y(this,l);var c=Se(this);c.name=r,c.scale=+i||1,Array.isArray(a)?c.origin=[+a[0]||0,+a[1]||0]:c.origin=[+a||0,+a||0],Array.isArray(s)?c.rotates=[!!s[0],!!s[1]]:c.rotates=[!!s,!!s],c.projector=this.projector}return g(l,[{key:"project",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=Se(this).projector(e);if(Number.isNaN(r[0])||Number.isNaN(r[1]))throw new Error("Could not project point ["+e+"]");return t&&(r[1]=-r[1]||0),r}},{key:"unproject",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=Se(this).projector.invert([e[0],t?-e[1]||0:e[1]]);if(Number.isNaN(r[0])||Number.isNaN(r[1]))throw new Error("Could not unproject point ["+e+"]");return r}},{key:"sun",value:function(e){var t=this.origin;return Me.getPosition(e,t[1],t[0])}},{key:"moon",value:function(e){var t=this.origin;return Me.getMoonPosition(e,t[1],t[0])}},{key:"equals",value:function(e){return this.name===e.name&&this.scale===e.scale&&this.origin[0]===e.origin[0]&&this.origin[1]===e.origin[1]&&this.rotates[0]===e.rotates[0]&&this.rotates[1]===e.rotates[1]}},{key:"toJSON",value:function(){return{name:this.name,scale:this.scale,origin:this.origin,rotates:this.rotates}}},{key:"projector",get:function(){var e="geo"+this.name,t=h[e]||o[e];if(null==t)throw new Error('Could not find projection for name "'+this.name+'"');var r=t();if("function"==typeof r.rotate){var n=[0,0,0];this.rotates[0]&&(n[0]=-this.origin[0]),this.rotates[1]&&(n[1]=-this.origin[1]),r.rotate(n)}r.translate([0,0]),r.scale(this.scale);var i=r(this.origin);return Array.isArray(i)&&r.translate([-i[0],-i[1]]),r}},{key:"path",get:function(){return h.geoPath().projection(Se(this).projector)}},{key:"name",get:function(){return Se(this).name}},{key:"scale",get:function(){return Se(this).scale}},{key:"origin",get:function(){return[].concat(w(Se(this).origin))}},{key:"rotates",get:function(){return[].concat(w(Se(this).rotates))}},{key:"hash",get:function(){var e=Se(this);return null==e.hash&&(e.hash=p.Hash(this.toJSON())),e.hash}}]),l}(),Oe=function(e){function t(){return y(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"us",[new c("state"),new c("county",{coerce:function(e){return parseInt(e,10)},super:function(e){return parseInt((""+e).slice(0,-3),10)}})]))}return r(t,l),t}(),Te=function(e){function t(){return y(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"world",[new c("country")]))}return r(t,l),t}(),Ze={Division:a,DivisionLevel:c,Geography:l,GeographyBuilder:be,GeometryPack:j,JapanGeography:we,JapanRegionalMesh:Pe,Path:pe,Projection:Ce,USGeography:Oe,WorldGeography:Te};e.Division=a,e.DivisionLevel=c,e.Geography=l,e.GeographyBuilder=be,e.GeometryPack=j,e.JapanGeography=we,e.JapanRegionalMesh=Pe,e.Path=pe,e.Projection=Ce,e.USGeography=Oe,e.WorldGeography=Te,e.default=Ze,Object.defineProperty(e,"__esModule",{value:!0})});