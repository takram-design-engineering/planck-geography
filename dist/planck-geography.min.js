!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@takram/planck-core"),require("three"),require("d3"),require("d3-geo-projection")):"function"==typeof define&&define.amd?define(["exports","@takram/planck-core","three","d3","d3-geo-projection"],t):t(e.Planck=e.Planck||{},e.Planck,e.THREE,e.d3,e.d3)}(this,function(e,p,v,h,o){"use strict";var y=function(e){return function(){var u=e.apply(this,arguments);return new Promise(function(o,a){return function t(e,r){try{var n=u[e](r),i=n.value}catch(e){return void a(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});o(i)}("next")})}},d=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},g=function(){function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},r=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},x=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(n=(a=u.next()).done)&&(r.push(a.value),!t||r.length!==t);n=!0);}catch(e){i=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw o}}return r}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},b=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},w=p.Namespace("Division"),s=function(){function n(e,t){d(this,n);var r=w(this);r.level=e,r.code=t}var t,r,i,o,a,u,s,c,f,l;return g(n,[{key:"properties",value:(l=y(regeneratorRuntime.mark(function e(t){var r,n,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.level.properties(t);case 2:if(r=e.sent,n=this.code,null!=(i=r[n])){e.next=8;break}throw o=this.level.identifier,new Error("Could not find properties for "+o+" "+n);case 8:return e.abrupt("return",i);case 9:case"end":return e.stop()}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"bounds",value:(f=y(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.properties(t);case 2:return e.abrupt("return",e.sent.bounds);case 3:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"area",value:(c=y(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.properties(t);case 2:return e.abrupt("return",e.sent.area);case 3:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"centroid",value:(s=y(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.properties(t);case 2:return e.abrupt("return",e.sent.centroid);case 3:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"poleOfInaccessibility",value:(u=y(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.properties(t);case 2:return e.abrupt("return",e.sent.poleOfInaccessibility);case 3:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"geometry",value:(a=y(regeneratorRuntime.mark(function e(t,r){var n,i,o,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.level.geometries(t,r);case 2:if(n=e.sent,i=this.code,null!=(o=n[i])){e.next=8;break}throw a=this.level.identifier,new Error("Could not find "+t+" geometry for "+a+" "+i);case 8:return e.abrupt("return",o);case 9:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"shapeGeometry",value:(o=y(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.geometry("shapes",t));case 1:case"end":return e.stop()}},e,this)})),function(e){return o.apply(this,arguments)})},{key:"outlineGeometry",value:(i=y(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.geometry("outlines",t));case 1:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"borderGeometry",value:(r=y(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.geometry("borders",t));case 1:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"subdivisionGeometry",value:(t=y(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.geometry("subdivisions",t));case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"belongsTo",value:function(e){return e.level===this.level.superlevel&&e.code===this.level.coder.super(this.code)}},{key:"code",get:function(){return w(this).code}},{key:"level",get:function(){return w(this).level}},{key:"geography",get:function(){return this.level.geography}},{key:"data",get:function(){var t=this,e=w(this);return null==e.data&&(e.data=this.level.data.find(function(e){return e.code===t.code})),e.data}},{key:"name",get:function(){return this.data.name}},{key:"localizedName",get:function(){return this.data.localizedName||this.data.name}},{key:"neighbors",get:function(){var t=this,e=w(this);return null==e.neighbors&&(e.neighbors=this.data.neighbors.map(function(e){return t.constructor.for(e)})),[].concat(b(e.neighbors))}},{key:"superdivision",get:function(){var t=this,e=w(this);if(null==e.superdivision){var r=this.level.superlevel;e.superdivision=r?r.divisions.find(function(e){return t.belongsTo(e)}):null}return e.superdivision}},{key:"subdivisions",get:function(){var t=this,e=w(this);if(null==e.subdivisions){var r=this.level.sublevel;e.subdivisions=r?r.divisions.filter(function(e){return e.belongsTo(t)}):[]}return[].concat(b(e.subdivisions))}}]),n}();function k(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=e.toJSON(),n=r.data||{},i=[],o=t;if(n.index){var a=e.index.array,u=a.buffer;i.push([u,o]),n.index.array=[o,a.length],o+=u.byteLength}if(n.attributes)for(var s=Object.keys(n.attributes),c=0;c<s.length;++c){var f=s[c],l=e.attributes[f].array,h=l.buffer;i.push([h,o]),n.attributes[f].array=[o,l.length],o+=h.byteLength}return r.data=n,[r,i,o]}function c(e,t){var r=m({},e,{data:m({},e.data)});if(r.data.index){var n=r.data.index.type,i=new(Function.prototype.bind.apply(p.globalScope[n],[null].concat([t],b(r.data.index.array))));r.data.index=m({},r.data.index,{array:i})}if(r.data.attributes){for(var o={},a=Object.keys(r.data.attributes),u=0;u<a.length;++u){var s=a[u],c=r.data.attributes[s],f=c.type,l=new(Function.prototype.bind.apply(p.globalScope[f],[null].concat([t],b(c.array))));o[s]=m({},c,{array:l})}r.data.attributes=o}return(new v.BufferGeometryLoader).parse(r)}function i(e,t){for(var r=new ArrayBuffer(t),n=new Uint8Array(r),i=0;i<e.length;++i){var o=x(e[i],2),a=o[0],u=o[1];n.set(new Uint8Array(a),u)}return r}var q={packBufferGeometry:function(e){var t=k(e),r=x(t,3);return[r[0],i(r[1],r[2])]},packBufferGeometries:function(e){var t=function(e){if(Array.isArray(e)){for(var t=[],r=[],n=0,i=0;i<e.length;++i){var o=k(e[i],n),a=x(o,3),u=a[0],s=a[1],c=a[2];t.push(u),r.push.apply(r,b(s)),n=c}return[t,r,n]}for(var f={},l=[],h=0,p=Object.keys(e),v=0;v<p.length;++v){var y=p[v],d=k(e[y],h),g=x(d,3);u=g[0],s=g[1],c=g[2],f[y]=u,l.push.apply(l,b(s)),h=c}return[f,l,h]}(e),r=x(t,3);return[r[0],i(r[1],r[2])]},unpackBufferGeometry:function(e,t){return c(e,t)},unpackBufferGeometries:function(e,t){if(Array.isArray(e)){for(var r=[],n=0;n<e.length;++n)r.push(c(e,t));return r}for(var i={},o=Object.keys(e),a=0;a<o.length;++a){var u=o[a];i[u]=c(e[u],t)}return i}},f=p.Namespace("DivisionLevel"),a=function(){function n(e,t){d(this,n);var r=f(this);r.identifier=e,r.coder=t,r.divisions={},r.properties={},r.geometries={}}var r,i,t;return g(n,[{key:"init",value:function(e){f(this).geography=e}},{key:"division",value:function(e){var t=f(this),r=t.divisions[e];return null==r&&(r=new s(this,e),t.divisions[e]=r),r}},{key:"properties",value:(t=y(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=f(this),n=t?t.hash:null,null==r.properties[n]&&(i=p.FilePath.join(p.FilePath.dirname(this.geography.path),n||"",this.geography.identifier,this.identifier,"properties.json"),r.properties[n]=p.Request.json(i,{local:!0})),e.abrupt("return",r.properties[n]);case 4:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"geometries",value:(i=y(regeneratorRuntime.mark(function e(t,r){var n,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=f(this),i=r?r.hash:null,null==(o=n.geometries[i])&&(o={},n.geometries[i]=o),null==o[t]&&(o[t]=this.requestGeometries(t,r)),e.abrupt("return",o[t]);case 6:case"end":return e.stop()}},e,this)})),function(e,t){return i.apply(this,arguments)})},{key:"requestGeometries",value:(r=y(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=p.FilePath.join(p.FilePath.dirname(this.geography.path),r.hash,this.geography.identifier,this.identifier,t),o=i=void 0,e.prev=3,e.next=6,Promise.all([p.Request.json(n+".json"),p.Request.buffer(n+".buffer")]);case 6:a=e.sent,u=x(a,2),i=u[0],o=u[1],e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(3),e.t0;case 15:return e.abrupt("return",q.unpackBufferGeometries(i,o));case 16:case"end":return e.stop()}},e,this,[[3,12]])})),function(e,t){return r.apply(this,arguments)})},{key:"identifier",get:function(){return f(this).identifier}},{key:"coder",get:function(){return f(this).coder}},{key:"geography",get:function(){return f(this).geography}},{key:"data",get:function(){var e=f(this);return null==e.data&&(e.data=this.geography.data[this.identifier]),e.data}},{key:"divisions",get:function(){var a=this,u=f(this);return u.divisions=m({},u.divisions,this.data.reduce(function(e,t){var r,n,i,o=t.code;return null==u.divisions[o]?m({},e,(r={},i=new s(a,n=o),n in r?Object.defineProperty(r,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[n]=i,r)):e},{})),Object.values(u.divisions)}},{key:"codes",get:function(){var e=f(this);return null==e.codes&&(e.codes=this.data.map(function(e){return e.code})),[].concat(b(e.codes))}},{key:"superlevel",get:function(){var e=f(this);if(null==e.superlevel){var t=this.geography.levels,r=t.indexOf(this);if(-1===r)throw new Error("Could not find levels for geography");e.superlevel=t[r-1]||null}return e.superlevel}},{key:"sublevel",get:function(){var e=f(this);if(null==e.sublevel){var t=this.geography.levels,r=t.indexOf(this);if(-1===r)throw new Error("Could not find levels for geography");e.sublevel=t[r+1]||null}return e.sublevel}}]),n}(),j=p.Namespace("Geography"),u=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];d(this,n);var r=j(this);r.identifier=e,r.levels=t,r.properties={},r.geometries={}}var t,r,i,o,a,u,s,c,f,l,h;return g(n,[{key:"init",value:(h=y(regeneratorRuntime.mark(function e(t,r){var n,i=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((n=j(this)).path=t,!r){e.next=8;break}return e.next=5,Promise.resolve(r);case 5:n.data=e.sent,e.next=11;break;case 8:return e.next=10,p.Request.json(t,{local:!0});case 10:n.data=e.sent;case 11:return e.next=13,Promise.all(this.levels.map(function(e){return e.init(i)}));case 13:case"end":return e.stop()}},e,this)})),function(e,t){return h.apply(this,arguments)})},{key:"division",value:function(t,e){var r=this.levels.find(function(e){return e.identifier===t});if(null==r)throw new Error("Could not find "+t+" level in geography");return r.division(e)}},{key:"divisions",value:function(t){var e=this.levels.find(function(e){return e.identifier===t});if(null==e)throw new Error("Could not find "+t+" level in geography");return e.divisions}},{key:"codes",value:function(t){var e=this.levels.find(function(e){return e.identifier===t});if(null==e)throw new Error("Could not find "+t+" level in geography");return e.codes}},{key:"properties",value:(l=y(regeneratorRuntime.mark(function e(t){var r,n,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=j(this),n=t?t.hash:null,null==r.properties[n]&&(i=p.FilePath.join(p.FilePath.dirname(this.path),n||"",this.identifier,"properties.json"),r.properties[n]=p.Request.json(i,{local:!0})),e.abrupt("return",r.properties[n]);case 4:case"end":return e.stop()}},e,this)})),function(e){return l.apply(this,arguments)})},{key:"bounds",value:(f=y(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.properties(t);case 2:return e.abrupt("return",e.sent.bounds);case 3:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"area",value:(c=y(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.properties(t);case 2:return e.abrupt("return",e.sent.area);case 3:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"centroid",value:(s=y(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.properties(t);case 2:return e.abrupt("return",e.sent.centroid);case 3:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"poleOfInaccessibility",value:(u=y(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.properties(t);case 2:return e.abrupt("return",e.sent.poleOfInaccessibility);case 3:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"geometry",value:(a=y(regeneratorRuntime.mark(function e(t,r){var n,i,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=j(this),i=r?r.hash:null,null==(o=n.geometries[i])&&(o={},n.geometries[i]=o),null==o[t]&&(o[t]=this.requestGeometry(t,r)),e.abrupt("return",o[t]);case 6:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"requestGeometry",value:(o=y(regeneratorRuntime.mark(function e(t,r){var n,i,o,a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=p.FilePath.join(p.FilePath.dirname(this.path),r.hash,this.identifier,t),o=i=void 0,e.prev=3,e.next=6,Promise.all([p.Request.json(n+".json"),p.Request.buffer(n+".buffer")]);case 6:a=e.sent,u=x(a,2),i=u[0],o=u[1],e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(3),e.t0;case 15:return e.abrupt("return",q.unpackBufferGeometry(i,o));case 16:case"end":return e.stop()}},e,this,[[3,12]])})),function(e,t){return o.apply(this,arguments)})},{key:"shapeGeometry",value:(i=y(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.geometry("shape",t));case 1:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"outlineGeometry",value:(r=y(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.geometry("outline",t));case 1:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"subdivisionGeometry",value:(t=y(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.geometry("subdivision",t));case 1:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"identifier",get:function(){return j(this).identifier}},{key:"levels",get:function(){return[].concat(b(j(this).levels))}},{key:"path",get:function(){return j(this).path}},{key:"data",get:function(){var e=j(this);if(!e.data)throw new Error("Data is missing for "+this.identifier);return e.data}}]),n}();function l(e){return e}function t(e,t){var o=function(e){if(null==e)return l;var o,a,u=e.scale[0],s=e.scale[1],c=e.translate[0],f=e.translate[1];return function(e,t){t||(o=a=0);var r=2,n=e.length,i=new Array(n);for(i[0]=(o+=e[0])*u+c,i[1]=(a+=e[1])*s+f;r<n;)i[r]=e[r],++r;return i}}(e.transform),a=e.arcs;function i(e,t){t.length&&t.pop();for(var r=a[e<0?~e:e],n=0,i=r.length;n<i;++n)t.push(o(r[n],n));e<0&&function(e,t){for(var r,n=e.length,i=n-t;i<--n;)r=e[i],e[i++]=e[n],e[n]=r}(t,i)}function u(e){return o(e)}function s(e){for(var t=[],r=0,n=e.length;r<n;++r)i(e[r],t);return t.length<2&&t.push(t[0]),t}function r(e){for(var t=s(e);t.length<4;)t.push(t[0]);return t}function c(e){return e.map(r)}return function e(t){var r,n=t.type;switch(n){case"GeometryCollection":return{type:n,geometries:t.geometries.map(e)};case"Point":r=u(t.coordinates);break;case"MultiPoint":r=t.coordinates.map(u);break;case"LineString":r=s(t.arcs);break;case"MultiLineString":r=t.arcs.map(s);break;case"Polygon":r=c(t.arcs);break;case"MultiPolygon":r=t.arcs.map(c);break;default:return null}return{type:n,coordinates:r}}(t)}function A(s,i){var o={},c={},f={},a=[],u=-1;function e(e,t){for(var r in e){var n=e[r];delete t[n.start],delete n.start,delete n.end,n.forEach(function(e){o[e<0?~e:e]=1}),a.push(n)}}return i.forEach(function(e,t){var r,n=s.arcs[e<0?~e:e];n.length<3&&!n[1][0]&&!n[1][1]&&(r=i[++u],i[u]=e,i[t]=r)}),i.forEach(function(e){var t,r,n=function(e){var t,r=s.arcs[e<0?~e:e],n=r[0];s.transform?(t=[0,0],r.forEach(function(e){t[0]+=e[0],t[1]+=e[1]})):t=r[r.length-1];return e<0?[t,n]:[n,t]}(e),i=n[0],o=n[1];if(t=f[i])if(delete f[t.end],t.push(e),t.end=o,r=c[o]){delete c[r.start];var a=r===t?t:t.concat(r);c[a.start=t.start]=f[a.end=r.end]=a}else c[t.start]=f[t.end]=t;else if(t=c[o])if(delete c[t.start],t.unshift(e),t.start=i,r=f[i]){delete f[r.end];var u=r===t?t:r.concat(t);c[u.start=r.start]=f[u.end=t.end]=u}else c[t.start]=f[t.end]=t;else c[(t=[e]).start=i]=f[t.end=o]=t}),e(f,c),e(c,f),i.forEach(function(e){o[e<0?~e:e]||a.push([e])}),a}function R(e){return t(e,function(e,t,r){var n,i,o;if(1<arguments.length)n=function(e,t,r){var n,i=[],o=[];function a(e){var t=e<0?~e:e;(o[t]||(o[t]=[])).push({i:e,g:n})}function u(e){e.forEach(a)}function s(e){e.forEach(u)}return function e(t){switch((n=t).type){case"GeometryCollection":t.geometries.forEach(e);break;case"LineString":u(t.arcs);break;case"MultiLineString":case"Polygon":s(t.arcs);break;case"MultiPolygon":t.arcs.forEach(s)}}(t),o.forEach(null==r?function(e){i.push(e[0].i)}:function(e){r(e[0].g,e[e.length-1].g)&&i.push(e[0].i)}),i}(0,t,r);else for(i=0,n=new Array(o=e.arcs.length);i<o;++i)n[i]=i;return{type:"MultiLineString",arcs:A(e,n)}}.apply(this,arguments))}function E(e){return t(e,function(u,e){var s={},r=[],n=[];function i(t){t.forEach(function(e){e.forEach(function(e){(s[e=e<0?~e:e]||(s[e]=[])).push(t)})}),r.push(t)}function c(e){return function(e){for(var t,r=-1,n=e.length,i=e[n-1],o=0;++r<n;)t=i,i=e[r],o+=t[0]*i[1]-t[1]*i[0];return Math.abs(o)}(t(u,{type:"Polygon",arcs:[e]}).coordinates[0])}return e.forEach(function e(t){switch(t.type){case"GeometryCollection":t.geometries.forEach(e);break;case"Polygon":i(t.arcs);break;case"MultiPolygon":t.arcs.forEach(i)}}),r.forEach(function(e){if(!e._){var t=[],r=[e];for(e._=1,n.push(t);e=r.pop();)t.push(e),e.forEach(function(e){e.forEach(function(e){s[e<0?~e:e].forEach(function(e){e._||(e._=1,r.push(e))})})})}}),r.forEach(function(e){delete e._}),{type:"MultiPolygon",arcs:n.map(function(e){var t,r=[];if(e.forEach(function(e){e.forEach(function(e){e.forEach(function(e){s[e<0?~e:e].length<2&&r.push(e)})})}),1<(t=(r=A(u,r)).length))for(var n,i,o=1,a=c(r[0]);o<t;++o)(n=c(r[o]))>a&&(i=r[0],r[0]=r[o],r[o]=i,a=n);return r})}}.apply(this,arguments))}function P(e,t){for(var r=0,n=e.length;r<n;){var i=r+n>>>1;e[i]<t?r=i+1:n=i}return r}Math.PI;var G=S,M=S;function S(e,t,r){r=r||2;var n,i,o,a,u,s,c,f=t&&t.length,l=f?t[0]*r:e.length,h=C(e,0,l,r,!0),p=[];if(!h)return p;if(f&&(h=function(e,t,r,n){var i,o,a,u,s,c=[];for(i=0,o=t.length;i<o;i++)a=t[i]*n,u=i<o-1?t[i+1]*n:e.length,(s=C(e,a,u,n,!1))===s.next&&(s.steiner=!0),c.push(L(s));for(c.sort(U),i=0;i<c.length;i++)B(c[i],r),r=O(r,r.next);return r}(e,t,h,r)),e.length>80*r){n=o=e[0],i=a=e[1];for(var v=r;v<l;v+=r)(u=e[v])<n&&(n=u),(s=e[v+1])<i&&(i=s),o<u&&(o=u),a<s&&(a=s);c=0!==(c=Math.max(o-n,a-i))?1/c:0}return T(h,p,r,n,i,c),p}function C(e,t,r,n,i){var o,a;if(i===0<Y(e,t,r,n))for(o=t;o<r;o+=n)a=W(o,e[o],e[o+1],a);else for(o=r-n;t<=o;o-=n)a=W(o,e[o],e[o+1],a);return a&&H(a,a.next)&&(K(a),a=a.next),a}function O(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!H(n,n.next)&&0!==D(n.prev,n,n.next))n=n.next;else{if(K(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function T(e,t,r,n,i,o,a){if(e){!a&&o&&function(e,t,r,n){var i=e;for(;null===i.z&&(i.z=F(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next,i!==e;);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,o,a,u,s,c=1;do{for(r=e,o=e=null,a=0;r;){for(a++,n=r,t=u=0;t<c&&(u++,n=n.nextZ);t++);for(s=c;0<u||0<s&&n;)0!==u&&(0===s||!n||r.z<=n.z)?(r=(i=r).nextZ,u--):(n=(i=n).nextZ,s--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}o.nextZ=null,c*=2}while(1<a)}(i)}(e,n,i,o);for(var u,s,c=e;e.prev!==e.next;)if(u=e.prev,s=e.next,o?Z(e,n,i,o):_(e))t.push(u.i/r),t.push(e.i/r),t.push(s.i/r),K(e),e=s.next,c=s.next;else if((e=s)===c){a?1===a?T(e=z(e,t,r),t,r,n,i,o,2):2===a&&N(e,t,r,n,i,o):T(O(e),t,r,n,i,o,1);break}}}function _(e){var t=e.prev,r=e,n=e.next;if(0<=D(t,r,n))return!1;for(var i=e.next.next;i!==e.prev;){if(I(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&0<=D(i.prev,i,i.next))return!1;i=i.next}return!0}function Z(e,t,r,n){var i=e.prev,o=e,a=e.next;if(0<=D(i,o,a))return!1;for(var u=i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,s=i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,c=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,f=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,l=F(u,s,t,r,n),h=F(c,f,t,r,n),p=e.prevZ,v=e.nextZ;p&&p.z>=l&&v&&v.z<=h;){if(p!==e.prev&&p!==e.next&&I(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&0<=D(p.prev,p,p.next))return!1;if(p=p.prevZ,v!==e.prev&&v!==e.next&&I(i.x,i.y,o.x,o.y,a.x,a.y,v.x,v.y)&&0<=D(v.prev,v,v.next))return!1;v=v.nextZ}for(;p&&p.z>=l;){if(p!==e.prev&&p!==e.next&&I(i.x,i.y,o.x,o.y,a.x,a.y,p.x,p.y)&&0<=D(p.prev,p,p.next))return!1;p=p.prevZ}for(;v&&v.z<=h;){if(v!==e.prev&&v!==e.next&&I(i.x,i.y,o.x,o.y,a.x,a.y,v.x,v.y)&&0<=D(v.prev,v,v.next))return!1;v=v.nextZ}return!0}function z(e,t,r){var n=e;do{var i=n.prev,o=n.next.next;!H(i,o)&&J(i,n,n.next,o)&&Q(i,o)&&Q(o,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(o.i/r),K(n),K(n.next),n=e=o),n=n.next}while(n!==e);return n}function N(e,t,r,n,i,o){var a,u,s=e;do{for(var c=s.next.next;c!==s.prev;){if(s.i!==c.i&&(u=c,(a=s).next.i!==u.i&&a.prev.i!==u.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&J(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(a,u)&&Q(a,u)&&Q(u,a)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;for(;r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next,r!==e;);return n}(a,u))){var f=V(s,c);return s=O(s,s.next),f=O(f,f.next),T(s,t,r,n,i,o),void T(f,t,r,n,i,o)}c=c.next}s=s.next}while(s!==e)}function U(e,t){return e.x-t.x}function B(e,t){if(t=function(e,t){var r,n=t,i=e.x,o=e.y,a=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var u=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=i&&a<u){if((a=u)===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===a)return r.prev;var s,c=r,f=r.x,l=r.y,h=1/0;n=r.next;for(;n!==c;)i>=n.x&&n.x>=f&&i!==n.x&&I(o<l?i:a,o,f,l,o<l?a:i,o,n.x,n.y)&&((s=Math.abs(o-n.y)/(i-n.x))<h||s===h&&n.x>r.x)&&Q(n,e)&&(r=n,h=s),n=n.next;return r}(e,t)){var r=V(t,e);O(r,r.next)}}function F(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function L(e){for(var t=e,r=e;t.x<r.x&&(r=t),(t=t.next)!==e;);return r}function I(e,t,r,n,i,o,a,u){return 0<=(i-a)*(t-u)-(e-a)*(o-u)&&0<=(e-a)*(n-u)-(r-a)*(t-u)&&0<=(r-a)*(o-u)-(i-a)*(n-u)}function D(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function H(e,t){return e.x===t.x&&e.y===t.y}function J(e,t,r,n){return!!(H(e,t)&&H(r,n)||H(e,n)&&H(r,t))||0<D(e,t,r)!=0<D(e,t,n)&&0<D(r,n,e)!=0<D(r,n,t)}function Q(e,t){return D(e.prev,e,e.next)<0?0<=D(e,t,e.next)&&0<=D(e,e.prev,t):D(e,t,e.prev)<0||D(e,e.next,t)<0}function V(e,t){var r=new X(e.i,e.x,e.y),n=new X(t.i,t.x,t.y),i=e.next,o=t.prev;return(e.next=t).prev=e,(r.next=i).prev=r,(n.next=r).prev=n,(o.next=n).prev=o,n}function W(e,t,r,n){var i=new X(e,t,r);return n?(i.next=n.next,(i.prev=n).next.prev=i,n.next=i):(i.prev=i).next=i,i}function K(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function X(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Y(e,t,r,n){for(var i=0,o=t,a=r-n;o<r;o+=n)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}S.deviation=function(e,t,r,n){var i=t&&t.length,o=i?t[0]*r:e.length,a=Math.abs(Y(e,0,o,r));if(i)for(var u=0,s=t.length;u<s;u++){var c=t[u]*r,f=u<s-1?t[u+1]*r:e.length;a-=Math.abs(Y(e,c,f,r))}var l=0;for(u=0;u<n.length;u+=3){var h=n[u]*r,p=n[u+1]*r,v=n[u+2]*r;l+=Math.abs((e[h]-e[v])*(e[p+1]-e[h+1])-(e[h]-e[p])*(e[v+1]-e[h+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},S.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)r.vertices.push(e[i][o][a]);0<i&&(n+=e[i-1].length,r.holes.push(n))}return r},G.default=M;var $=ee;function ee(e,t){if(!(this instanceof ee))return new ee(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||te,0<this.length)for(var r=this.length>>1;0<=r;r--)this._down(r)}function te(e,t){return e<t?-1:t<e?1:0}ee.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,0<this.length&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,r=this.compare,n=t[e];0<e;){var i=e-1>>1,o=t[i];if(0<=r(n,o))break;t[e]=o,e=i}t[e]=n},_down:function(e){for(var t=this.data,r=this.compare,n=this.length,i=n>>1,o=t[e];e<i;){var a=1+(e<<1),u=a+1,s=t[a];if(u<n&&r(t[u],s)<0&&(s=t[a=u]),0<=r(s,o))break;t[e]=s,e=a}t[e]=o}};var re=Object.freeze({default:$,__moduleExports:$}),ne=re&&$||re,ie=ae,oe=ae;function ae(e,t,r){var n,i,o,a;t=t||1;for(var u=0;u<e[0].length;u++){var s=e[0][u];(!u||s[0]<n)&&(n=s[0]),(!u||s[1]<i)&&(i=s[1]),(!u||s[0]>o)&&(o=s[0]),(!u||s[1]>a)&&(a=s[1])}var c=o-n,f=a-i,l=Math.min(c,f),h=l/2,p=new ne(null,ue);if(0===l)return[n,i];for(var v=n;v<o;v+=l)for(var y=i;y<a;y+=l)p.push(new se(v+h,y+h,h,e));var d=function(e){for(var t=0,r=0,n=0,i=e[0],o=0,a=i.length,u=a-1;o<a;u=o++){var s=i[o],c=i[u],f=s[0]*c[1]-c[0]*s[1];r+=(s[0]+c[0])*f,n+=(s[1]+c[1])*f,t+=3*f}return 0===t?new se(i[0][0],i[0][1],0,e):new se(r/t,n/t,0,e)}(e),g=new se(n+c/2,i+f/2,0,e);g.d>d.d&&(d=g);for(var m=p.length;p.length;){var x=p.pop();x.d>d.d&&(d=x,r&&console.log("found best %d after %d probes",Math.round(1e4*x.d)/1e4,m)),x.max-d.d<=t||(h=x.h/2,p.push(new se(x.x-h,x.y-h,h,e)),p.push(new se(x.x+h,x.y-h,h,e)),p.push(new se(x.x-h,x.y+h,h,e)),p.push(new se(x.x+h,x.y+h,h,e)),m+=4)}return r&&(console.log("num probes: "+m),console.log("best distance: "+d.d)),[d.x,d.y]}function ue(e,t){return t.max-e.max}function se(e,t,r,n){this.x=e,this.y=t,this.h=r,this.d=function(e,t,r){for(var n=!1,i=1/0,o=0;o<r.length;o++)for(var a=r[o],u=0,s=a.length,c=s-1;u<s;c=u++){var f=a[u],l=a[c];f[1]>t!=l[1]>t&&e<(l[0]-f[0])*(t-f[1])/(l[1]-f[1])+f[0]&&(n=!n),i=Math.min(i,ce(e,t,f,l))}return(n?1:-1)*Math.sqrt(i)}(e,t,n),this.max=this.d+this.h*Math.SQRT2}function ce(e,t,r,n){var i=r[0],o=r[1],a=n[0]-i,u=n[1]-o;if(0!==a||0!==u){var s=((e-i)*a+(t-o)*u)/(a*a+u*u);1<s?(i=n[0],o=n[1]):0<s&&(i+=a*s,o+=u*s)}return(a=e-i)*a+(u=t-o)*u}function Be(e,t,r,n){this.message=e,this.expected=t,this.found=r,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,Be)}ie.default=oe,function(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}(Be,Error),Be.buildMessage=function(e,t){var r,o={literal:function(e){return'"'+i(e.text)+'"'},class:function(e){var t,r="";for(t=0;t<e.parts.length;t++)r+=e.parts[t]instanceof Array?a(e.parts[t][0])+"-"+a(e.parts[t][1]):a(e.parts[t]);return"["+(e.inverted?"^":"")+r+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function i(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+n(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+n(e)})}function a(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(e){return"\\x0"+n(e)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(e){return"\\x"+n(e)})}return"Expected "+function(e){var t,r,n,i=new Array(e.length);for(t=0;t<e.length;t++)i[t]=(n=e[t],o[n.type](n));if(i.sort(),0<i.length){for(r=t=1;t<i.length;t++)i[t-1]!==i[t]&&(i[r]=i[t],r++);i.length=r}switch(i.length){case 1:return i[0];case 2:return i[0]+" or "+i[1];default:return i.slice(0,-1).join(", ")+", or "+i[i.length-1]}}(e)+" but "+((r=t)?'"'+i(r)+'"':"end of input")+" found."};var fe={SyntaxError:Be,parse:function(u,e){e=void 0!==e?e:{};var t,l={},r={svg_path:ve},n=ve,o=function(e){if(!e)return[];for(var t=[],r=0;r<e.length;r++)t=t.concat.apply(t,e[r]);var n=t[0];return n&&"m"==n.code&&(delete n.relative,n.code="M"),t},a=function(e,t){return function(e,t){if(!t)return[e];for(var r=[e],n=0,i=t.length;n<i;n++)r[n+1]=t[n][1];return r}(e,t)},s=/^[Mm]/,c=fe(["M","m"],!1,!1),f=function(e,t,r){var n=Ue(e,[t]);return r&&(n=n.concat(Ue("M"==e?"L":"l",r[1]))),n},i=/^[Zz]/,h=fe(["Z","z"],!1,!1),p=function(){return Ue("Z")},v=/^[Ll]/,y=fe(["L","l"],!1,!1),d=function(e,t){return Ue(e,t)},g=/^[Hh]/,m=fe(["H","h"],!1,!1),x=function(e,t){return Ue(e,t.map(function(e){return{x:e}}))},b=/^[Vv]/,w=fe(["V","v"],!1,!1),k=function(e,t){return Ue(e,t.map(function(e){return{y:e}}))},q=/^[Cc]/,j=fe(["C","c"],!1,!1),A=function(e,t,r){return{x1:e.x,y1:e.y,x2:t.x,y2:t.y,x:r.x,y:r.y}},R=/^[Ss]/,E=fe(["S","s"],!1,!1),P=function(e,t){return{x2:e.x,y2:e.y,x:t.x,y:t.y}},G=/^[Qq]/,M=fe(["Q","q"],!1,!1),S=function(e,t){return{x1:e.x,y1:e.y,x:t.x,y:t.y}},C=/^[Tt]/,O=fe(["T","t"],!1,!1),T=/^[Aa]/,_=fe(["A","a"],!1,!1),Z=function(e,t,r,n,i,o){return{rx:e,ry:t,xAxisRotation:r,largeArc:n,sweep:i,x:o.x,y:o.y}},z=function(e,t){return{x:e,y:t}},N=function(e){return 1*e},U=function(e){return 1*e.join("")},B=/^[01]/,F=fe(["0","1"],!1,!1),L=function(e){return"1"==e},I=function(){return""},D=",",H=ce(",",!1),J=function(e){return e.join("")},Q=".",V=ce(".",!1),W=/^[eE]/,K=fe(["e","E"],!1,!1),X=/^[+\-]/,Y=fe(["+","-"],!1,!1),$=/^[0-9]/,ee=fe([["0","9"]],!1,!1),te=function(e){return e.join("")},re=/^[ \t\n\r]/,ne=fe([" ","\t","\n","\r"],!1,!1),ie=0,oe=[{line:1,column:1}],ae=0,ue=[],se=0;if("startRule"in e){if(!(e.startRule in r))throw new Error("Can't start parsing from rule \""+e.startRule+'".');n=r[e.startRule]}function ce(e,t){return{type:"literal",text:e,ignoreCase:t}}function fe(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function le(e){var t,r=oe[e];if(r)return r;for(t=e-1;!oe[t];)t--;for(r={line:(r=oe[t]).line,column:r.column};t<e;)10===u.charCodeAt(t)?(r.line++,r.column=1):r.column++,t++;return oe[e]=r}function he(e,t){var r=le(e),n=le(t);return{start:{offset:e,line:r.line,column:r.column},end:{offset:t,line:n.line,column:n.column}}}function pe(e){ie<ae||(ae<ie&&(ae=ie,ue=[]),ue.push(e))}function ve(){var e,t,r,n,i;for(e=ie,t=[],r=Oe();r!==l;)t.push(r),r=Oe();if(t!==l)if((r=function(){var e,t,r,n,i,o;if(e=ie,(t=ye())!==l){for(r=[],n=ie,i=[],o=Oe();o!==l;)i.push(o),o=Oe();for(i!==l&&(o=ye())!==l?n=i=[i,o]:(ie=n,n=l);n!==l;){for(r.push(n),n=ie,i=[],o=Oe();o!==l;)i.push(o),o=Oe();i!==l&&(o=ye())!==l?n=i=[i,o]:(ie=n,n=l)}r!==l?(t=a(t,r),e=t):(ie=e,e=l)}else ie=e,e=l;return e}())===l&&(r=null),r!==l){for(n=[],i=Oe();i!==l;)n.push(i),i=Oe();n!==l?e=t=o(r):(ie=e,e=l)}else ie=e,e=l;else ie=e,e=l;return e}function ye(){var e,t,r,n,i,o;if(e=ie,(t=function(){var e,t,r,n,i,o,a;if(e=ie,s.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=l,0===se&&pe(c)),t!==l){for(r=[],n=Oe();n!==l;)r.push(n),n=Oe();r!==l&&(n=qe())!==l?(i=ie,(o=Ee())===l&&(o=null),o!==l&&(a=ge())!==l?i=o=[o,a]:(ie=i,i=l),i===l&&(i=null),i!==l?(t=f(t,n,i),e=t):(ie=e,e=l)):(ie=e,e=l)}else ie=e,e=l;return e}())!==l){for(r=[],n=ie,i=[],o=Oe();o!==l;)i.push(o),o=Oe();for(i!==l&&(o=de())!==l?n=i=[i,o]:(ie=n,n=l);n!==l;){for(r.push(n),n=ie,i=[],o=Oe();o!==l;)i.push(o),o=Oe();i!==l&&(o=de())!==l?n=i=[i,o]:(ie=n,n=l)}r!==l?e=t=a(t,r):(ie=e,e=l)}else ie=e,e=l;return e}function de(){var e,t;return i.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=l,0===se&&pe(h)),t!==l&&(t=p()),(e=t)===l&&(e=function(){var e,t,r,n;if(e=ie,v.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=l,0===se&&pe(y)),t!==l){for(r=[],n=Oe();n!==l;)r.push(n),n=Oe();r!==l&&(n=ge())!==l?(t=d(t,n),e=t):(ie=e,e=l)}else ie=e,e=l;return e}())===l&&(e=function(){var e,t,r,n;if(e=ie,g.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=l,0===se&&pe(m)),t!==l){for(r=[],n=Oe();n!==l;)r.push(n),n=Oe();r!==l&&(n=me())!==l?(t=x(t,n),e=t):(ie=e,e=l)}else ie=e,e=l;return e}())===l&&(e=function(){var e,t,r,n;if(e=ie,b.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=l,0===se&&pe(w)),t!==l){for(r=[],n=Oe();n!==l;)r.push(n),n=Oe();r!==l&&(n=me())!==l?(t=k(t,n),e=t):(ie=e,e=l)}else ie=e,e=l;return e}())===l&&(e=function(){var e,t,r,n;if(e=ie,q.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=l,0===se&&pe(j)),t!==l){for(r=[],n=Oe();n!==l;)r.push(n),n=Oe();r!==l&&(n=function(){var e,t,r,n,i,o;if(e=ie,(t=xe())!==l){for(r=[],n=ie,(i=Ee())===l&&(i=null),i!==l&&(o=xe())!==l?n=i=[i,o]:(ie=n,n=l);n!==l;)r.push(n),n=ie,(i=Ee())===l&&(i=null),i!==l&&(o=xe())!==l?n=i=[i,o]:(ie=n,n=l);r!==l?(t=a(t,r),e=t):(ie=e,e=l)}else ie=e,e=l;return e}())!==l?(t=d(t,n),e=t):(ie=e,e=l)}else ie=e,e=l;return e}())===l&&(e=function(){var e,t,r,n;if(e=ie,R.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=l,0===se&&pe(E)),t!==l){for(r=[],n=Oe();n!==l;)r.push(n),n=Oe();r!==l&&(n=function(){var e,t,r,n,i,o;if(e=ie,(t=be())!==l){for(r=[],n=ie,(i=Ee())===l&&(i=null),i!==l&&(o=be())!==l?n=i=[i,o]:(ie=n,n=l);n!==l;)r.push(n),n=ie,(i=Ee())===l&&(i=null),i!==l&&(o=be())!==l?n=i=[i,o]:(ie=n,n=l);r!==l?(t=a(t,r),e=t):(ie=e,e=l)}else ie=e,e=l;return e}())!==l?(t=d(t,n),e=t):(ie=e,e=l)}else ie=e,e=l;return e}())===l&&(e=function(){var e,t,r,n;if(e=ie,G.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=l,0===se&&pe(M)),t!==l){for(r=[],n=Oe();n!==l;)r.push(n),n=Oe();r!==l&&(n=function(){var e,t,r,n,i,o;if(e=ie,(t=we())!==l){for(r=[],n=ie,(i=Ee())===l&&(i=null),i!==l&&(o=we())!==l?n=i=[i,o]:(ie=n,n=l);n!==l;)r.push(n),n=ie,(i=Ee())===l&&(i=null),i!==l&&(o=we())!==l?n=i=[i,o]:(ie=n,n=l);r!==l?(t=a(t,r),e=t):(ie=e,e=l)}else ie=e,e=l;return e}())!==l?(t=d(t,n),e=t):(ie=e,e=l)}else ie=e,e=l;return e}())===l&&(e=function(){var e,t,r,n;if(e=ie,C.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=l,0===se&&pe(O)),t!==l){for(r=[],n=Oe();n!==l;)r.push(n),n=Oe();r!==l&&(n=function(){var e,t,r,n,i,o;if(e=ie,(t=qe())!==l){for(r=[],n=ie,(i=Ee())===l&&(i=null),i!==l&&(o=qe())!==l?n=i=[i,o]:(ie=n,n=l);n!==l;)r.push(n),n=ie,(i=Ee())===l&&(i=null),i!==l&&(o=qe())!==l?n=i=[i,o]:(ie=n,n=l);r!==l?(t=a(t,r),e=t):(ie=e,e=l)}else ie=e,e=l;return e}())!==l?(t=d(t,n),e=t):(ie=e,e=l)}else ie=e,e=l;return e}())===l&&(e=function(){var e,t,r,n;if(e=ie,T.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=l,0===se&&pe(_)),t!==l){for(r=[],n=Oe();n!==l;)r.push(n),n=Oe();r!==l&&(n=function(){var e,t,r,n,i,o;if(e=ie,(t=ke())!==l){for(r=[],n=ie,(i=Ee())===l&&(i=null),i!==l&&(o=ke())!==l?n=i=[i,o]:(ie=n,n=l);n!==l;)r.push(n),n=ie,(i=Ee())===l&&(i=null),i!==l&&(o=ke())!==l?n=i=[i,o]:(ie=n,n=l);r!==l?(t=a(t,r),e=t):(ie=e,e=l)}else ie=e,e=l;return e}())!==l?(t=d(t,n),e=t):(ie=e,e=l)}else ie=e,e=l;return e}()),e}function ge(){var e,t,r,n,i,o;if(e=ie,(t=qe())!==l){for(r=[],n=ie,(i=Ee())===l&&(i=null),i!==l&&(o=qe())!==l?n=i=[i,o]:(ie=n,n=l);n!==l;)r.push(n),n=ie,(i=Ee())===l&&(i=null),i!==l&&(o=qe())!==l?n=i=[i,o]:(ie=n,n=l);r!==l?e=t=a(t,r):(ie=e,e=l)}else ie=e,e=l;return e}function me(){var e,t,r,n,i,o;if(e=ie,(t=Ae())!==l){for(r=[],n=ie,(i=Ee())===l&&(i=null),i!==l&&(o=Ae())!==l?n=i=[i,o]:(ie=n,n=l);n!==l;)r.push(n),n=ie,(i=Ee())===l&&(i=null),i!==l&&(o=Ae())!==l?n=i=[i,o]:(ie=n,n=l);r!==l?e=t=a(t,r):(ie=e,e=l)}else ie=e,e=l;return e}function xe(){var e,t,r,n,i,o;return e=ie,(t=qe())!==l?((r=Ee())===l&&(r=null),r!==l&&(n=qe())!==l?((i=Ee())===l&&(i=null),i!==l&&(o=qe())!==l?e=t=A(t,n,o):(ie=e,e=l)):(ie=e,e=l)):(ie=e,e=l),e}function be(){var e,t,r,n;return e=ie,(t=qe())!==l?((r=Ee())===l&&(r=null),r!==l&&(n=qe())!==l?e=t=P(t,n):(ie=e,e=l)):(ie=e,e=l),e}function we(){var e,t,r,n;return e=ie,(t=qe())!==l?((r=Ee())===l&&(r=null),r!==l&&(n=qe())!==l?e=t=S(t,n):(ie=e,e=l)):(ie=e,e=l),e}function ke(){var e,t,r,n,i,o,a,u,s,c,f;return e=ie,(t=je())!==l?((r=Ee())===l&&(r=null),r!==l&&(n=je())!==l?((i=Ee())===l&&(i=null),i!==l&&(o=Ae())!==l&&Ee()!==l&&(a=Re())!==l?((u=Ee())===l&&(u=null),u!==l&&(s=Re())!==l?((c=Ee())===l&&(c=null),c!==l&&(f=qe())!==l?e=t=Z(t,n,o,a,s,f):(ie=e,e=l)):(ie=e,e=l)):(ie=e,e=l)):(ie=e,e=l)):(ie=e,e=l),e}function qe(){var e,t,r,n;return e=ie,(t=Ae())!==l?((r=Ee())===l&&(r=null),r!==l&&(n=Ae())!==l?e=t=z(t,n):(ie=e,e=l)):(ie=e,e=l),e}function je(){var e;return(e=Ge())===l&&(e=Ce()),e!==l&&(e=N(e)),e}function Ae(){var e,t,r;return e=ie,(t=Se())===l&&(t=null),t!==l&&(r=Ge())!==l?e=t=[t,r]:(ie=e,e=l),e===l&&(e=ie,(t=Se())===l&&(t=null),t!==l&&(r=Ce())!==l?e=t=[t,r]:(ie=e,e=l)),e!==l&&(e=U(e)),e}function Re(){var e;return B.test(u.charAt(ie))?(e=u.charAt(ie),ie++):(e=l,0===se&&pe(F)),e!==l&&(e=L(e)),e}function Ee(){var e,t,r,n,i;if(e=ie,t=[],(r=Oe())!==l)for(;r!==l;)t.push(r),r=Oe();else t=l;if(t!==l)if((r=Pe())===l&&(r=null),r!==l){for(n=[],i=Oe();i!==l;)n.push(i),i=Oe();n!==l?e=t=[t,r,n]:(ie=e,e=l)}else ie=e,e=l;else ie=e,e=l;if(e===l){if(t=e=ie,(r=Pe())!==l){for(n=[],i=Oe();i!==l;)n.push(i),i=Oe();n!==l?t=r=[r,n]:(ie=t,t=l)}else ie=t,t=l;t!==l&&(t=I()),e=t}return e}function Pe(){var e;return 44===u.charCodeAt(ie)?(e=D,ie++):(e=l,0===se&&pe(H)),e}function Ge(){var e,t,r,n,i,o,a;return n=e=ie,(i=Ce())===l&&(i=null),i!==l?(46===u.charCodeAt(ie)?(o=Q,ie++):(o=l,0===se&&pe(V)),o!==l&&(a=Ce())!==l?n=i=[i,o,a]:(ie=n,n=l)):(ie=n,n=l),n===l&&(n=ie,(i=Ce())!==l?(46===u.charCodeAt(ie)?(o=Q,ie++):(o=l,0===se&&pe(V)),o!==l?n=i=[i,o]:(ie=n,n=l)):(ie=n,n=l)),n!==l&&(n=J(n)),(t=n)!==l?((r=Me())===l&&(r=null),r!==l?e=t=[t,r]:(ie=e,e=l)):(ie=e,e=l),e===l&&(e=ie,(t=Ce())!==l&&(r=Me())!==l?e=t=[t,r]:(ie=e,e=l)),e!==l&&(e=J(e)),e}function Me(){var e,t,r,n;return e=ie,W.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=l,0===se&&pe(K)),t!==l?((r=Se())===l&&(r=null),r!==l&&(n=Ce())!==l?e=t=[t,r,n]:(ie=e,e=l)):(ie=e,e=l),e!==l&&(e=J(e)),e}function Se(){var e;return X.test(u.charAt(ie))?(e=u.charAt(ie),ie++):(e=l,0===se&&pe(Y)),e}function Ce(){var e,t;if(e=[],$.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=l,0===se&&pe(ee)),t!==l)for(;t!==l;)e.push(t),$.test(u.charAt(ie))?(t=u.charAt(ie),ie++):(t=l,0===se&&pe(ee));else e=l;return e!==l&&(e=te(e)),e}function Oe(){var e;return re.test(u.charAt(ie))?(e=u.charAt(ie),ie++):(e=l,0===se&&pe(ne)),e!==l&&(e=I()),e}var Te,_e,Ze,ze={m:"moveto",l:"lineto",h:"horizontal lineto",v:"vertical lineto",c:"curveto",s:"smooth curveto",q:"quadratic curveto",t:"smooth quadratic curveto",a:"elliptical arc",z:"closepath"};for(var Ne in ze)ze[Ne.toUpperCase()]=ze[Ne];function Ue(e,t){t||(t=[{}]);for(var r=t.length;r--;){var n={code:e,command:ze[e]};for(var i in e==e.toLowerCase()&&(n.relative=!0),t[r])n[i]=t[r][i];t[r]=n}return t}if((t=n())!==l&&ie===u.length)return t;throw t!==l&&ie<u.length&&pe({type:"end"}),Te=ue,_e=ae<u.length?u.charAt(ae):null,Ze=ae<u.length?he(ae,ae+1):he(ae,ae),new Be(Be.buildMessage(Te,_e),Te,_e,Ze)}},le=fe.parse,he=Object.freeze({default:fe,__moduleExports:fe,parse:le}),pe=(he&&fe||he).parse;(pe.parseSVG=pe).makeAbsolute=function(e){var r,n={x:0,y:0},i={x:"x0",y:"y0",x1:"x0",y1:"y0",x2:"x0",y2:"y0"};return e.forEach(function(e){for(var t in"moveto"===e.command&&(r=e),e.x0=n.x,e.y0=n.y,i)t in e&&(e[t]+=e.relative?e[i[t]]:0);"x"in e||(e.x=n.x),"y"in e||(e.y=n.y),e.relative=!1,e.code=e.code.toUpperCase(),"closepath"==e.command&&(e.x=r.x,e.y=r.y),n=e}),e};var ve=pe;function ye(e,t){return e.x*t.y-e.y*t.x}function de(e,t,r){if(e.x<r.x&&r.x<=t.x||t.x<r.x&&r.x<=e.x){var n=e.y;if(e.x!==t.x&&(n=e.y+(t.y-e.y)*(r.x-e.x)/(t.x-e.x)),r.y>n)return 1}return 0}var ge={winding:function(e){if(!(e.length<3)){var t=e[0],r=ye(e[e.length-1].v2,t.v1);return(r=e.reduce(function(e,t){return e+ye(t.v1,t.v2)},r))<0?"ccw":0<r?"cw":void 0}},contains:function(e,r){if(e.length<3)return!1;var t=e[0],n=de(e[e.length-1].v2,t.v1,r);return(n=e.reduce(function(e,t){return e+de(t.v1,t.v2,r)},n))%2==1},parse:function(e){var r=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=0,i=0,o=0,a=0,u=0,s=0,c=void 0,t=ve(e).reduce(function(e,t){switch(t.code){case"M":case"m":!0===t.relative?(u+=t.x,s+=t.y):(u=t.x,s=t.y),c&&0===c.curves.length&&e.pop(),c=new v.Path,e.push(c),r?c.moveTo(u,-s):c.moveTo(u,s);break;case"L":case"l":!0===t.relative?(u+=t.x,s+=t.y):(u=t.x,s=t.y),r?c.lineTo(u,-s):c.lineTo(u,s);break;case"V":case"v":!0===t.relative?s+=t.y:s=t.y,r?c.lineTo(u,-s):c.lineTo(u,s);break;case"H":case"h":!0===t.relative?u+=t.x:u=t.x,r?c.lineTo(u,-s):c.lineTo(u,s);break;case"C":case"c":!0===t.relative?(n=u+t.x1,i=s+t.y1,o=u+t.x2,a=s+t.y2,u+=t.x,s+=t.y):(n=t.x1,i=t.y1,o=t.x2,a=t.y2,u=t.x,s=t.y),r?c.bezierCurveTo(n,-i,o,-a,u,-s):c.bezierCurveTo(n,i,o,a,u,s);break;case"S":case"s":n=u+(u-o),i=s+(s-a),!0===t.relative?(o=u+t.x2,a=s+t.y2,u+=t.x,s+=t.y):(o=t.x2,a=t.y2,u=t.x,s=t.y),r?c.bezierCurveTo(n,-i,o,-a,u,-s):c.bezierCurveTo(n,i,o,a,u,s);break;case"Q":case"q":!0===t.relative?(n=u+t.x1,i=s+t.y1,u+=t.x,s+=t.y):(n=t.x1,i=t.y1,u=t.x,s=t.y),r?c.quadraticCurveTo(n,-i,u,-s):c.quadraticCurveTo(n,i,u,s);break;case"T":case"t":n=u+(u-n),i=s+(s-i),!0===t.relative?(u+=t.x,s+=t.y):(u=t.x,s=t.y),r?c.quadraticCurveTo(n,-i,u,-s):c.quadraticCurveTo(n,i,u,s);break;case"A":case"a":throw new p.ImplementationError;case"Z":c.closePath();break;default:throw new Error('Unknown code "'+t.code+'"')}return e},[]);return 0===t.length?null:1===t.length?t[0]:t.reduce(function(e,t){return e.add(t),e},new v.Shape)}};function me(e){return e+"Code"}function xe(e,t,r){var n=me(e);return r.properties[n]===t}function be(e,t){var r=e.reduce(function(e,t){return e.concat(t.x,t.y)},[]),n=e.length,i=[];t.forEach(function(e,t){i.push(n),n+=e.length,r=r.concat(e.reduce(function(e,t){return e.concat(t.x,t.y)},[]))});for(var o=G(r,i,2),a=[],u=0;u<o.length;u+=3)a.push(o.slice(u,u+3));return a}function we(e,u){var s=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];return e.coordinates.reduce(function(e,t,r){var n=u.path({type:"Polygon",coordinates:t});if(!n)return s.push(r),e;var i=ge.parse(n,!0),o=void 0;o=i instanceof v.Shape?i.curves:[i];var a=new v.Shape;return o.forEach(function(e){var t=ge.winding(e.curves);"ccw"===t?a.add(e):"cw"===t&&a.holes.push(e)}),0===a.holes.length?e.concat(a.curves.map(function(e){var t=new v.Shape;return t.add(e),t})):e.concat(a)},[])}function ke(e){var n=new Float32Array(6*e.length);e.forEach(function(e,t){var r=6*t;n[r+0]=e.v1.x,n[r+1]=e.v1.y,n[r+3]=e.v2.x,n[r+4]=e.v2.y});var t=new v.BufferGeometry,r=new v.BufferAttribute(n,3);return t.addAttribute("position",r),t}var qe=p.Namespace("GeographyBuilder"),je=function(){function t(e){d(this,t),qe(this).levels=[].concat(b(e))}var r;return g(t,[{key:"init",value:(r=y(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=qe(this),"string"!=typeof t){e.next=7;break}return e.next=4,p.Request.json(t,{local:!0});case 4:r.data=e.sent,e.next=10;break;case 7:return e.next=9,Promise.resolve(t);case 9:r.data=e.sent;case 10:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"property",value:function(e,t){var r=t.level,n=t.code,i=t.projection,o=this.data.objects.geography.geometries;r&&(o=o.filter(function(e){return xe(r,n,e)}));var a=E(this.data,o);return i?i.path[e](a):h["geo"+e.charAt().toUpperCase()+e.slice(1)](a)}},{key:"bounds",value:function(e){return this.property("bounds",e)}},{key:"area",value:function(e){return this.property("area",e)}},{key:"centroid",value:function(e){return this.property("centroid",e)}},{key:"poleOfInaccessibility",value:function(e){var t=e.level,r=e.code,n=e.projection,i=e.precision,o=void 0===i?.01:i,a=this.data.objects.geography.geometries;if(t&&(a=a.filter(function(e){return xe(t,r,e)})),a=E(this.data,a),n){var u=p.Array.max(a.coordinates,function(e){return n.path.area({type:"Polygon",coordinates:e})});if(!u)return console.warn("Unable to derive pole of inaccessibility:",t,r),null;var s=n.path({type:"Polygon",coordinates:u});if(!s)return console.warn("Unable to derive pole of inaccessibility:",t,r),null;var c=ge.parse(s,!0);if(!c)return console.warn("Unable to derive pole of inaccessibility:",t,r),null;var f=(c instanceof v.Shape?c.curves:[c]).map(function(e){return e.curves.map(function(e){return[e.v1.x,e.v1.y]})});return ie(f,Math.sqrt(n.path.area({type:"Polygon",coordinates:u}))*o)}var l=p.Array.max(a.coordinates,function(e){return h.geoArea({type:"Polygon",coordinates:e})});return l?ie(l,Math.sqrt(h.geoArea({type:"Polygon",coordinates:l}))*o):(console.warn("Unable to derive pole of inaccessibility:",t,r),null)}},{key:"shapes",value:function(e){var t=e.geometries,r=e.projection,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return we(E(this.data,t),r,n)}},{key:"shapeGeometry",value:function(e){var t=e.geometries,r=e.projection,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return function(e){var t=v.ShapeUtils.triangulateShape;v.ShapeUtils.triangulateShape=be;var r=(new v.BufferGeometry).fromGeometry(e.reduce(function(e,t){return e.merge(new v.ShapeGeometry(t)),e},new v.Geometry));return v.ShapeUtils.triangulateShape=t,r.computeBoundingSphere(),r}(we(E(this.data,t),r,n))}},{key:"outlineGeometry",value:function(e){var t=e.geometries,r=e.projection,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],i=we(E(this.data,t),r,n);return ke(i.reduce(function(e,t){return e.concat(t.curves.reduce(function(e,t){return e.concat(t.curves)},[]),t.holes.reduce(function(e,t){return e.concat(t.curves)},[]))},[]))}},{key:"borderGeometry",value:function(e){var t=e.object,r=e.filter,n=e.projection,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],o=R(this.data,t,r),a=n.path(o);if(!a)return i.push(0),ke([]);var u=ge.parse(a,!0);return ke(u instanceof v.Shape?u.curves.reduce(function(e,t){return e.concat(t.curves)},[]):u.curves)}},{key:"geographyShapes",value:function(e){var t=e.projection,r=this.data.objects.geography.geometries,n=[],i=this.shapes({projection:t,geometries:r},n);return 0!==n.length&&console.warn("Unable to project "+n.length+" polygons"),i}},{key:"geographyShapeGeometry",value:function(e){var t=e.projection,r=this.data.objects.geography.geometries,n=[],i=this.shapeGeometry({projection:t,geometries:r},n);return 0!==n.length&&console.warn("Unable to project "+n.length+" polygons"),i}},{key:"geographyOutlineGeometry",value:function(e){var t=e.projection,r=this.data.objects.geography.geometries,n=[],i=this.outlineGeometry({projection:t,geometries:r},n);return 0!==n.length&&console.warn("Unable to project "+n.length+" polygons"),i}},{key:"geographySubdivisionGeometry",value:function(e){var t=e.projection,r=me(this.levels[0]),n=[],i=this.borderGeometry({projection:t,object:this.data.objects.geography,filter:function(e,t){return e.properties[r]!==t.properties[r]}},n);return 0!==n.length?new v.BufferGeometry:i}},{key:"divisionShapes",value:function(e){var t=e.level,r=e.code,n=e.projection,i=this.data.objects.geography.geometries,o=[],a=this.shapes({projection:n,geometries:i.filter(function(e){return xe(t,r,e)})},o);return 0!==o.length&&console.warn(o.length+" polygons failed to project"),a}},{key:"divisionShapeGeometry",value:function(e){var t=e.level,r=e.code,n=e.projection,i=this.data.objects.geography.geometries,o=[],a=this.shapeGeometry({projection:n,geometries:i.filter(function(e){return xe(t,r,e)})},o);return 0!==o.length&&console.warn("Unable to project "+o.length+" polygons:",t,r),a}},{key:"divisionOutlineGeometry",value:function(e){var t=e.level,r=e.code,n=e.projection,i=this.data.objects.geography.geometries,o=[],a=this.outlineGeometry({projection:n,geometries:i.filter(function(e){return xe(t,r,e)})},o);return 0!==o.length&&console.warn("Unable to project "+o.length+" polygons:",t,r),a}},{key:"divisionBorderGeometry",value:function(e){var t=this,r=e.level,n=e.code,i=e.projection,o=function(){var e=t.levels.indexOf(r);if(-1===e)throw new Error('Could not find level "'+r+'" in geography');if(0<e)return t.levels[e-1]}(),a=this.data.objects.geography.geometries;o&&(a=a.filter(function(e){return xe(o,n,e)}));var u=a.filter(function(e){return xe(r,n,e)}).map(function(e){return a.indexOf(e)}),s=function(e){var n={},t=e.map(function(){return[]});function r(e,r){e.forEach(function(e){e<0&&(e=~e);var t=n[e];t?t.push(r):n[e]=[r]})}function i(e,t){e.forEach(function(e){r(e,t)})}var o={LineString:r,MultiLineString:i,Polygon:i,MultiPolygon:function(e,t){e.forEach(function(e){i(e,t)})}};for(var a in e.forEach(function t(e,r){"GeometryCollection"===e.type?e.geometries.forEach(function(e){t(e,r)}):e.type in o&&o[e.type](e.arcs,r)}),n)for(var u=n[a],s=u.length,c=0;c<s;++c)for(var f=c+1;f<s;++f){var l,h=u[c],p=u[f];(l=t[h])[a=P(l,p)]!==p&&l.splice(a,0,p),(l=t[p])[a=P(l,h)]!==h&&l.splice(a,0,h)}return t}(a),c={type:"GeometryCollection",geometries:a.filter(function(e,t){return u.includes(t)||u.some(function(e){return s[e].includes(t)})})},f=me(r),l=[],h=this.borderGeometry({projection:i,object:c,filter:function(e,t){return e.properties[f]===n?e.properties[f]<t.properties[f]:e.properties[f]>t.properties[f]}},l);return 0!==l.length?new v.BufferGeometry:h}},{key:"divisionSubdivisionGeometry",value:function(e){var t=e.level,r=e.code,n=e.projection,i={type:"GeometryCollection",geometries:this.data.objects.geography.geometries.filter(function(e){return xe(t,r,e)})},o=[],a=this.borderGeometry({projection:n,object:i,filter:function(e,t){return e!==t}},o);return 0!==o.length?new v.BufferGeometry:a}},{key:"levels",get:function(){return[].concat(b(qe(this).levels))}},{key:"data",get:function(){return qe(this).data}}]),t}(),Ae=function(e){function t(){return d(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"japan",[new a("prefecture"),new a("municipality",{coerce:function(e){return parseInt(e,10)},super:function(e){return parseInt((""+e).slice(0,-3),10)}})]))}return r(t,u),t}();function Re(e,t){return{quotient:Math.floor(e/t),remainder:e%t}}function Ee(e){var t=Math.floor(e);return{integral:t,fractional:e-t}}var Pe={primary:function(e){var t=Re(60*e[1],40);return 100*t.quotient+1*(t=Ee(e[0]-100)).integral},secondary:function(e){var t=Re(60*e[1],40),r=t.quotient,n=(t=Re(t.remainder,5)).quotient;return 1e4*r+100*(t=Ee(e[0]-100)).integral+10*n+1*(t=Re(60*t.fractional,7.5)).quotient},basic:function(e){var t=Re(60*e[1],40),r=t.quotient,n=(t=Re(t.remainder,5)).quotient,i=(t=Re(60*t.remainder,30)).quotient;return 1e6*r+1e4*(t=Ee(e[0]-100)).integral+1e3*n+100*(t=Re(60*t.fractional,7.5)).quotient+10*i+1*(t=Re(60*t.remainder,45)).quotient},half:function(e){var t=Re(60*e[1],40),r=t.quotient,n=(t=Re(t.remainder,5)).quotient,i=(t=Re(60*t.remainder,30)).quotient,o=(t=Re(t.remainder,15)).quotient;return 1e7*r+1e5*(t=Ee(e[0]-100)).integral+1e4*n+1e3*(t=Re(60*t.fractional,7.5)).quotient+100*i+10*(t=Re(60*t.remainder,45)).quotient+1*(2*o+(t=Re(t.remainder,22.5)).quotient+1)},quarter:function(e){var t=Re(60*e[1],40),r=t.quotient,n=(t=Re(t.remainder,5)).quotient,i=(t=Re(60*t.remainder,30)).quotient,o=(t=Re(t.remainder,15)).quotient,a=(t=Re(t.remainder,7.5)).quotient;return 1e8*r+1e6*(t=Ee(e[0]-100)).integral+1e5*n+1e4*(t=Re(60*t.fractional,7.5)).quotient+1e3*i+100*(t=Re(60*t.remainder,45)).quotient+10*(2*o+(t=Re(t.remainder,22.5)).quotient+1)+1*(2*a+(t=Re(t.remainder,11.25)).quotient+1)},eighth:function(e){var t=Re(60*e[1],40),r=t.quotient,n=(t=Re(t.remainder,5)).quotient,i=(t=Re(60*t.remainder,30)).quotient,o=(t=Re(t.remainder,15)).quotient,a=(t=Re(t.remainder,7.5)).quotient,u=(t=Re(t.remainder,3.75)).quotient;return 1e9*r+1e7*(t=Ee(e[0]-100)).integral+1e6*n+1e5*(t=Re(60*t.fractional,7.5)).quotient+1e4*i+1e3*(t=Re(60*t.remainder,45)).quotient+100*(2*o+(t=Re(t.remainder,22.5)).quotient+1)+10*(2*a+(t=Re(t.remainder,11.25)).quotient+1)+1*(2*u+(t=Re(t.remainder,5.625)).quotient+1)}},Ge={primary:function(e){var t=Re(e,100),r=t.quotient;return[3600*((t=Re(t.remainder,1)).quotient+100)/3600,2400*r/3600]},secondary:function(e){var t=Re(e,1e4),r=t.quotient,n=(t=Re(t.remainder,100)).quotient,i=(t=Re(t.remainder,10)).quotient;return[(3600*(n+100)+450*(t=Re(t.remainder,1)).quotient)/3600,(2400*r+300*i)/3600]},basic:function(e){var t=Re(e,1e6),r=t.quotient,n=(t=Re(t.remainder,1e4)).quotient,i=(t=Re(t.remainder,1e3)).quotient,o=(t=Re(t.remainder,100)).quotient,a=(t=Re(t.remainder,10)).quotient;return[(3600*(n+100)+450*o+45*(t=Re(t.remainder,1)).quotient)/3600,(2400*r+300*i+30*a)/3600]},half:function(e){var t=Re(e,1e7),r=t.quotient,n=(t=Re(t.remainder,1e5)).quotient,i=(t=Re(t.remainder,1e4)).quotient,o=(t=Re(t.remainder,1e3)).quotient,a=(t=Re(t.remainder,100)).quotient,u=(t=Re(t.remainder,10)).quotient,s=(t=Re(t.remainder,1)).quotient;return[(3600*(n+100)+450*o+45*u+22.5*(s-1&1))/3600,(2400*r+300*i+30*a+15*(s-1>>1))/3600]},quarter:function(e){var t=Re(e,1e8),r=t.quotient,n=(t=Re(t.remainder,1e6)).quotient,i=(t=Re(t.remainder,1e5)).quotient,o=(t=Re(t.remainder,1e4)).quotient,a=(t=Re(t.remainder,1e3)).quotient,u=(t=Re(t.remainder,100)).quotient,s=(t=Re(t.remainder,10)).quotient,c=(t=Re(t.remainder,1)).quotient;return[(3600*(n+100)+450*o+45*u+22.5*(s-1&1)+11.25*(c-1&1))/3600,(2400*r+300*i+30*a+15*(s-1>>1)+7.5*(c-1>>1))/3600]},eighth:function(e){var t=Re(e,1e9),r=t.quotient,n=(t=Re(t.remainder,1e7)).quotient,i=(t=Re(t.remainder,1e6)).quotient,o=(t=Re(t.remainder,1e5)).quotient,a=(t=Re(t.remainder,1e4)).quotient,u=(t=Re(t.remainder,1e3)).quotient,s=(t=Re(t.remainder,100)).quotient,c=(t=Re(t.remainder,10)).quotient,f=(t=Re(t.remainder,1)).quotient;return[(3600*(n+100)+450*o+45*u+22.5*(s-1&1)+11.25*(c-1&1)+5.625*(f-1&1))/3600,(2400*r+300*i+30*a+15*(s-1>>1)+7.5*(c-1>>1)+3.75*(f-1>>1))/3600]}},Me=p.Namespace("JapanRegionalMesh"),Se=function(){function n(e,t){d(this,n);var r=Me(this);r.name=e,r.size=[].concat(b(t))}return g(n,[{key:"code",value:function(e){return Pe[this.name](e)}},{key:"origin",value:function(e){return Ge[this.name](e)}},{key:"center",value:function(e){var t=this.origin(e),r=this.size;return[t[0]+r[0]/2,t[1]+r[1]/2]}},{key:"name",get:function(){return Me(this).name}},{key:"size",get:function(){return[].concat(b(Me(this).size))}}]),n}(),Ce={primary:new Se("primary",[1,2400/3600]),secondary:new Se("secondary",[.125,300/3600]),basic:new Se("basic",[.0125,30/3600]),half:new Se("half",[.00625,15/3600]),quarter:new Se("quarter",[.003125,7.5/3600]),eighth:new Se("eighth",[.0015625,3.75/3600])};var Oe,Te=(function(e,t){!function(){var b=Math.PI,l=Math.sin,h=Math.cos,p=Math.tan,n=Math.asin,v=Math.atan2,c=Math.acos,k=b/180,r=864e5,t=2440588,i=2451545;function w(e){return new Date((e+.5-t)*r)}function q(e){return e.valueOf()/r-.5+t-i}var o=23.4397*k;function a(e,t){return v(l(e)*h(o)-p(t)*l(o),h(e))}function j(e,t){return n(l(t)*h(o)+h(t)*l(o)*l(e))}function y(e,t,r){return v(l(e),h(e)*l(t)-p(r)*h(t))}function d(e,t,r){return n(l(t)*l(r)+h(t)*h(r)*h(e))}function g(e,t){return k*(280.16+360.9856235*e)-t}function A(e){return k*(357.5291+.98560028*e)}function R(e){return e+k*(1.9148*l(e)+.02*l(2*e)+3e-4*l(3*e))+102.9372*k+b}function s(e){var t=R(A(e));return{dec:j(t,0),ra:a(t,0)}}var E={getPosition:function(e,t,r){var n=k*-r,i=k*t,o=q(e),a=s(o),u=g(o,n)-a.ra;return{azimuth:y(u,i,a.dec),altitude:d(u,i,a.dec)}}},P=E.times=[[-.833,"sunrise","sunset"],[-.3,"sunriseEnd","sunsetStart"],[-6,"dawn","dusk"],[-12,"nauticalDawn","nauticalDusk"],[-18,"nightEnd","night"],[6,"goldenHourEnd","goldenHour"]];E.addTime=function(e,t,r){P.push([e,t,r])};var G=9e-4;function M(e,t,r){return G+(e+t)/(2*b)+r}function S(e,t,r){return i+e+.0053*l(t)-.0069*l(2*r)}function C(e,t,r,n,i,o,a){var u,s;return S(M((u=r,s=n,c((l(e)-l(u)*l(s))/(h(u)*h(s)))),t,i),o,a)}function m(e){var t=k*(134.963+13.064993*e),r=k*(93.272+13.22935*e),n=k*(218.316+13.176396*e)+6.289*k*l(t),i=5.128*k*l(r),o=385001-20905*h(t);return{ra:a(n,i),dec:j(n,i),dist:o}}function O(e,t){return new Date(e.valueOf()+t*r/24)}E.getTimes=function(e,t,r){var n,i,o,a,u,s,c,f=k*-r,l=k*t,h=q(e),p=(s=h,c=f,Math.round(s-G-c/(2*b))),v=M(0,f,p),y=A(v),d=R(y),g=j(d,0),m=S(v,y,d),x={solarNoon:w(m),nadir:w(m-.5)};for(n=0,i=P.length;n<i;n+=1)u=m-((a=C((o=P[n])[0]*k,f,l,g,p,y,d))-m),x[o[1]]=w(u),x[o[2]]=w(a);return x},E.getMoonPosition=function(e,t,r){var n,i=k*-r,o=k*t,a=q(e),u=m(a),s=g(a,i)-u.ra,c=d(s,o,u.dec),f=v(l(s),p(o)*h(u.dec)-l(u.dec)*h(s));return c+=((n=c)<0&&(n=0),2967e-7/Math.tan(n+.00312536/(n+.08901179))),{azimuth:y(s,o,u.dec),altitude:c,distance:u.dist,parallacticAngle:f}},E.getMoonIllumination=function(e){var t=q(e||new Date),r=s(t),n=m(t),i=c(l(r.dec)*l(n.dec)+h(r.dec)*h(n.dec)*h(r.ra-n.ra)),o=v(149598e3*l(i),n.dist-149598e3*h(i)),a=v(h(r.dec)*l(r.ra-n.ra),l(r.dec)*h(n.dec)-h(r.dec)*l(n.dec)*h(r.ra-n.ra));return{fraction:(1+h(o))/2,phase:.5+.5*o*(a<0?-1:1)/Math.PI,angle:a}},E.getMoonTimes=function(e,t,r,n){var i=new Date(e);n?i.setUTCHours(0,0,0,0):i.setHours(0,0,0,0);for(var o,a,u,s,c,f,l,h,p,v,y,d,g,m=.133*k,x=E.getMoonPosition(i,t,r).altitude-m,b=1;b<=24&&(o=E.getMoonPosition(O(i,b),t,r).altitude-m,h=((c=(x+(a=E.getMoonPosition(O(i,b+1),t,r).altitude-m))/2-o)*(l=-(f=(a-x)/2)/(2*c))+f)*l+o,(v=0)<=(p=f*f-4*c*o)&&(y=l-(g=Math.sqrt(p)/(2*Math.abs(c))),d=l+g,Math.abs(y)<=1&&v++,Math.abs(d)<=1&&v++,y<-1&&(y=d)),1===v?x<0?u=b+y:s=b+y:2===v&&(u=b+(h<0?d:y),s=b+(h<0?y:d)),!u||!s);b+=2)x=a;var w={};return u&&(w.rise=O(i,u)),s&&(w.set=O(i,s)),u||s||(w[0<h?"alwaysUp":"alwaysDown"]=!0),w},e.exports=E}()}(Oe={exports:{}},Oe.exports),Oe.exports),_e=p.Namespace("Projection"),Ze=function(){function f(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.name,r=void 0===t?"Equirectangular":t,n=e.scale,i=void 0===n?1e4:n,o=e.origin,a=void 0===o?[0,0]:o,u=e.rotates,s=void 0===u?[!0,!0]:u;d(this,f);var c=_e(this);c.name=r,c.scale=+i||1,Array.isArray(a)?c.origin=[+a[0]||0,+a[1]||0]:c.origin=[+a||0,+a||0],Array.isArray(s)?c.rotates=[!!s[0],!!s[1]]:c.rotates=[!!s,!!s],c.projector=this.projector}return g(f,[{key:"project",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=_e(this).projector(e);if(Number.isNaN(r[0])||Number.isNaN(r[1]))throw new Error("Could not project point ["+e+"]");return t&&(r[1]=-r[1]||0),r}},{key:"unproject",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=_e(this).projector.invert([e[0],t?-e[1]||0:e[1]]);if(Number.isNaN(r[0])||Number.isNaN(r[1]))throw new Error("Could not unproject point ["+e+"]");return r}},{key:"sun",value:function(e){var t=this.origin;return Te.getPosition(e,t[1],t[0])}},{key:"moon",value:function(e){var t=this.origin;return Te.getMoonPosition(e,t[1],t[0])}},{key:"equals",value:function(e){return this.name===e.name&&this.scale===e.scale&&this.origin[0]===e.origin[0]&&this.origin[1]===e.origin[1]&&this.rotates[0]===e.rotates[0]&&this.rotates[1]===e.rotates[1]}},{key:"toJSON",value:function(){return{name:this.name,scale:this.scale,origin:this.origin,rotates:this.rotates}}},{key:"projector",get:function(){var e="geo"+this.name,t=h[e]||o[e];if(null==t)throw new Error('Could not find projection for name "'+this.name+'"');var r=t();if("function"==typeof r.rotate){var n=[0,0,0];this.rotates[0]&&(n[0]=-this.origin[0]),this.rotates[1]&&(n[1]=-this.origin[1]),r.rotate(n)}r.translate([0,0]),r.scale(this.scale);var i=r(this.origin);return Array.isArray(i)&&r.translate([-i[0],-i[1]]),r}},{key:"path",get:function(){return h.geoPath().projection(_e(this).projector)}},{key:"name",get:function(){return _e(this).name}},{key:"scale",get:function(){return _e(this).scale}},{key:"origin",get:function(){return[].concat(b(_e(this).origin))}},{key:"rotates",get:function(){return[].concat(b(_e(this).rotates))}},{key:"hash",get:function(){var e=_e(this);return null==e.hash&&(e.hash=p.Hash(this.toJSON())),e.hash}}]),f}(),ze=function(e){function t(){return d(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"us",[new a("state"),new a("county",{coerce:function(e){return parseInt(e,10)},super:function(e){return parseInt((""+e).slice(0,-3),10)}})]))}return r(t,u),t}(),Ne=function(e){function t(){return d(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"world",[new a("country")]))}return r(t,u),t}(),Ue={Division:s,DivisionLevel:a,Geography:u,GeographyBuilder:je,GeometryPack:q,JapanGeography:Ae,JapanRegionalMesh:Ce,Path:ge,Projection:Ze,USGeography:ze,WorldGeography:Ne};e.Division=s,e.DivisionLevel=a,e.Geography=u,e.GeographyBuilder=je,e.GeometryPack=q,e.JapanGeography=Ae,e.JapanRegionalMesh=Ce,e.Path=ge,e.Projection=Ze,e.USGeography=ze,e.WorldGeography=Ne,e.default=Ue,Object.defineProperty(e,"__esModule",{value:!0})});